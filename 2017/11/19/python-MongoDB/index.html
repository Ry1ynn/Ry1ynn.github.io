<!DOCTYPE html>



  



<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">






  <meta name="keywords" content="python,MongoDB,">










<meta name="description" content="MongoDB00-简介 简介 MongoDB 是一个基于分布式 文件存储的NoSQL数据库 由C++语言编写，运行稳定，性能高 旨在为 WEB 应用提供可扩展的高性能数据存储解决方案 查看官方网站">
<meta name="keywords" content="python,MongoDB">
<meta property="og:type" content="article">
<meta property="og:title" content="python-MongoDB">
<meta property="og:url" content="http://21guns.top/2017/11/19/python-MongoDB/index.html">
<meta property="og:site_name" content="Ry1ynn&#39;s blogs">
<meta property="og:description" content="MongoDB00-简介 简介 MongoDB 是一个基于分布式 文件存储的NoSQL数据库 由C++语言编写，运行稳定，性能高 旨在为 WEB 应用提供可扩展的高性能数据存储解决方案 查看官方网站">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-5/24075422.jpg?ynotemdtimestamp=1550481900183">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-5/78041419.jpg?ynotemdtimestamp=1550481900183">
<meta property="og:updated_time" content="2019-02-18T09:27:09.749Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python-MongoDB">
<meta name="twitter:description" content="MongoDB00-简介 简介 MongoDB 是一个基于分布式 文件存储的NoSQL数据库 由C++语言编写，运行稳定，性能高 旨在为 WEB 应用提供可扩展的高性能数据存储解决方案 查看官方网站">
<meta name="twitter:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-5/24075422.jpg?ynotemdtimestamp=1550481900183">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://21guns.top/2017/11/19/python-MongoDB/">





  <title>python-MongoDB | Ry1ynn's blogs</title>
  










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ry1ynn's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://21guns.top/2017/11/19/python-MongoDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ry1ynn">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ry1ynn's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">python-MongoDB</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-19T17:24:08+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/数据库相关/" itemprop="url" rel="index">
                    <span itemprop="name">数据库相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><h2 id="00-简介"><a href="#00-简介" class="headerlink" title="00-简介"></a>00-简介</h2><ul>
<li>简介<ul>
<li>MongoDB 是一个基于<strong>分布式</strong> <strong>文件存储</strong>的NoSQL数据库</li>
<li>由C++语言编写，运行稳定，性能高</li>
<li>旨在为 WEB 应用提供可扩展的高性能数据存储解决方案</li>
<li>查看<a href="https://www.mongodb.com/" target="_blank" rel="noopener">官方网站</a><a id="more"></a></li>
</ul>
</li>
<li>MongoDB特点<ul>
<li>模式自由 :可以把不同结构的文档存储在同一个数据库里</li>
<li>面向集合的存储：适合存储 JSON风格文件的形式</li>
<li>完整的索引支持：对任何属性可索引</li>
<li>复制和高可用性：支持服务器之间的数据复制，支持主-从模式及服务器之间的相互复制。复制的主要目的是提供冗余及自动故障转移</li>
<li>自动分片：支持云级别的伸缩性：自动分片功能支持水平的数据库集群，可动态添加额外的机器</li>
<li>丰富的查询：支持丰富的查询表达方式，查询指令使用JSON形式的标记，可轻易查询文档中的内嵌的对象及数组</li>
<li>快速就地更新：查询优化器会分析查询表达式，并生成一个高效的查询计划</li>
<li>高效的传统存储方式：支持二进制数据及大型对象（如照片或图片）</li>
</ul>
</li>
</ul>
<h2 id="01-基本操作"><a href="#01-基本操作" class="headerlink" title="01-基本操作"></a>01-基本操作</h2><ul>
<li><p>基本操作</p>
<ul>
<li>MongoDB将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成</li>
<li>MongoDB文档类似于JSON对象，字段值可以包含其他文档、数组、文档数组</li>
<li>安装管理mongodb环境</li>
<li>完成数据库、集合的管理</li>
<li>数据的增加、修改、删除、查询</li>
</ul>
</li>
<li><p>名词</p>
<p>| SQL术语/概念 | MongoDB术语/概念 | 解释/说明                           |<br>| ———— | —————- | ———————————– |<br>| database     | database         | 数据库                              |<br>| table        | collection       | 数据库表/集合                       |<br>| row          | document         | 数据记录行/文档                     |<br>| column       | field            | 数据字段/域                         |<br>| index        | index            | 索引                                |<br>| table joins  |                  | 表连接,MongoDB不支持                |<br>| primary key  | primary key      | 主键,MongoDB自动将_id字段设置为主键 |</p>
</li>
<li><p>三元素：数据库，集合，文档</p>
<ul>
<li>集合就是关系数据库中的表</li>
<li>文档对应着关系数据库中的行</li>
</ul>
</li>
<li><p>文档，就是一个对象，由键值对构成，是json的扩展Bson形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&apos;name&apos;:&apos;guojing&apos;,&apos;gender&apos;:&apos;男&apos;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>集合：类似于关系数据库中的表，储存多个文档，结构不固定，如可以存储如下文档在一个集合中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&apos;name&apos;:&apos;guojing&apos;,&apos;gender&apos;:&apos;男&apos;&#125;</span><br><span class="line">&#123;&apos;name&apos;:&apos;huangrong&apos;,&apos;age&apos;:18&#125;</span><br><span class="line">&#123;&apos;book&apos;:&apos;shuihuzhuan&apos;,&apos;heros&apos;:&apos;108&apos;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库：是一个集合的物理容器，一个数据库中可以包含多个文档</p>
</li>
<li><p>一个服务器通常有多个数据库</p>
</li>
</ul>
<h3 id="1-1-环境安装"><a href="#1-1-环境安装" class="headerlink" title="1.1-环境安装"></a>1.1-环境安装</h3><ul>
<li><p>安装</p>
<ul>
<li><p>下载mongodb的版本，两点注意</p>
<ul>
<li>根据业界规则，偶数为稳定版，如1.6.X，奇数为开发版，如1.7.X</li>
<li>32bit的mongodb最大只能存放2G的数据，64bit就没有限制</li>
</ul>
</li>
<li><p>到官网，选择合适的版本下载</p>
</li>
<li><p>解压，<code>tar -zxvf mongodb-linux-x86_64-ubuntu1604-3.4.0.tgz</code></p>
</li>
<li><p>移动到/usr/local/目录下</p>
<p><code>sudo mv -r mongodb-linux-x86_64-ubuntu1604-3.4.0/ /usr/local/mongodb</code></p>
</li>
<li><p>将可执行文件添加到PATH路径中</p>
<p><code>export PATH=/usr/local/mongodb/bin:$PATH</code></p>
</li>
</ul>
</li>
<li><p>管理mongo</p>
<ul>
<li><p>配置文件在/etc/mongod.conf</p>
</li>
<li><p>默认端口27017</p>
</li>
<li><p>启动，<code>sudo service mongod start</code></p>
</li>
<li><p>停止，<code>sudo service mongod stop</code></p>
</li>
<li><p>使用终端连接</p>
</li>
<li><p>这个shell就是mongodb的客户端，同时也是一个js的编译器</p>
<p><code>mongo</code></p>
</li>
<li><p>命令</p>
<ul>
<li>db查看当前数据库名称</li>
<li>db.stats()查看当前数据库信息</li>
</ul>
</li>
<li><p>终端退出连接</p>
<p>exit 或ctrl+c</p>
</li>
<li><p>GUI：robomongo，解压后在bin目录下找到运行程序</p>
<p>界面如下</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-2-数据库操作"><a href="#1-2-数据库操作" class="headerlink" title="1.2-数据库操作"></a>1.2-数据库操作</h3><ul>
<li><p>数据库切换</p>
<ul>
<li><p>查看当前数据库名称，<code>db</code></p>
</li>
<li><p>查看所有数据库名称</p>
</li>
<li><p>列出所有在物理上存在的数据库， <code>show dbs</code></p>
</li>
<li><p>切换数据库</p>
</li>
<li><p>如果数据库不存在，则指向数据库，但不创建，直到插入数据或创建集合时数据库才被创建</p>
<p><code>use 数据库名称</code></p>
</li>
<li><p>默认的数据库为test，如果你没有创建新的数据库，集合将存放在test数据库中</p>
</li>
</ul>
</li>
<li><p>数据库删除</p>
<ul>
<li>删除当前指向的数据库</li>
<li>如果数据库不存在，则什么也不做</li>
<li><code>db.dropDatabase()</code></li>
</ul>
</li>
</ul>
<h3 id="1-3-集合操作"><a href="#1-3-集合操作" class="headerlink" title="1.3-集合操作"></a>1.3-集合操作</h3><ul>
<li><p>集合创建</p>
<ul>
<li><p>语法：<code>db.createCollection(name, options)</code></p>
<ul>
<li><p>name是要创建的集合的名称</p>
</li>
<li><p>options是一个文档，用于指定集合的配置</p>
</li>
<li><p>选项参数是可选的，所以只需要到指定的集合名称。以下是可以使用的选项列表：</p>
</li>
<li><p>例1：不限制集合大小</p>
<p><code>db.createCollection(&quot;stu&quot;)</code></p>
</li>
</ul>
</li>
<li><p>例2：限制集合大小，后面学会插入语句后可以查看效果</p>
</li>
<li><p>参数capped：默认值为false表示不设置上限，值为true表示设置上限</p>
</li>
<li><p>参数size：当capped值为true时，需要指定此参数，表示上限大小，当文档达到上限时，会将之前的数据覆盖，单位为字节</p>
<p><code>db.createCollection(&quot;sub&quot;, { capped : true, size : 10 } )</code></p>
</li>
</ul>
</li>
<li><p>查看当前数据库的集合</p>
<ul>
<li><p>语法</p>
<p><code>show collections</code></p>
</li>
</ul>
</li>
<li><p>删除</p>
<ul>
<li><p>语法</p>
<p><code>db.集合名称.drop()</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="1-4-数据类型"><a href="#1-4-数据类型" class="headerlink" title="1.4-数据类型"></a>1.4-数据类型</h3><ul>
<li>MongoDB中常用的几种数据类型：<ul>
<li>Object ID：文档ID</li>
<li>String：字符串，最常用，必须是有效的UTF-8</li>
<li>Boolean：存储一个布尔值，true或false</li>
<li>Integer：整数可以是32位或64位，这取决于服务器</li>
<li>Double：存储浮点值</li>
<li>Arrays：数组或列表，多个值存储到一个键</li>
<li>Object：用于嵌入式的文档，即一个值为一个文档</li>
<li>Null：存储Null值</li>
<li>Timestamp：时间戳</li>
<li>Date：存储当前日期或时间的UNIX时间格式</li>
</ul>
</li>
<li>object id<ul>
<li>每个文档都有一个属性，为_id，保证每个文档的唯一性</li>
<li>可以自己去设置_id插入文档</li>
<li>如果没有提供，那么MongoDB为每个文档提供了一个独特的_id，类型为objectID</li>
<li>objectID是一个12字节的十六进制数<ul>
<li>前4个字节为当前时间戳</li>
<li>接下来3个字节的机器ID</li>
<li>接下来的2个字节中MongoDB的服务进程id</li>
<li>最后3个字节是简单的增量值</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-5-数据操作"><a href="#1-5-数据操作" class="headerlink" title="1.5-数据操作"></a>1.5-数据操作</h3><ul>
<li><p>插入</p>
<ul>
<li><p>语法，<code>db.集合名称.insert(document)</code></p>
</li>
<li><p>插入文档时，如果不指定_id参数，MongoDB会为文档分配一个唯一的ObjectId</p>
</li>
<li><p>例1</p>
<p><code>db.stu.insert({name:&#39;gj&#39;,gender:1})</code></p>
</li>
<li><p>例2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1=&#123;_id:&apos;20160101&apos;,name:&apos;hr&apos;&#125;</span><br><span class="line">s1.gender=0</span><br><span class="line">db.stu.insert(s1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>简单查询</p>
<ul>
<li>语法 <code>db.集合名称.find()</code></li>
</ul>
</li>
</ul>
<ul>
<li><p>更新</p>
<ul>
<li><p>语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;multi: &lt;boolean&gt;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数query:查询条件，类似sql语句update中where部分</p>
</li>
<li><p>参数update:更新操作符，类似sql语句update中set部分</p>
</li>
<li><p>参数multi:可选，默认是false，表示只更新找到的第一条记录，值为true表示把满足条件的文档全部更新</p>
</li>
<li><p>例3：全文档更新</p>
<p><code>db.stu.update({name:&#39;hr&#39;},{name:&#39;mnc&#39;})</code></p>
</li>
<li><p>例4：指定属性更新，通过操作符$set</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.stu.insert(&#123;name:&apos;hr&apos;,gender:0&#125;)</span><br><span class="line">db.stu.update(&#123;name:&apos;hr&apos;&#125;,&#123;$set:&#123;name:&apos;hys&apos;&#125;&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>例5：修改多条匹配到的数据</p>
<p><code>db.stu.update({},{$set:{gender:0}},{multi:true})</code></p>
</li>
</ul>
</li>
<li><p>保存</p>
<ul>
<li><p>语法 <code>db.集合名称.save(document)</code></p>
</li>
<li><p>如果文档的_id已经存在则修改，如果文档的_id不存在则添加</p>
</li>
<li><p>例6</p>
<p><code>db.stu.save({_id:&#39;20160102&#39;,&#39;name&#39;:&#39;yk&#39;,gender:1})</code></p>
</li>
<li><p>例7 <code>db.stu.save({_id:&#39;20160102&#39;,&#39;name&#39;:&#39;wyk&#39;})</code></p>
</li>
</ul>
</li>
<li><p>删除</p>
<ul>
<li><p>语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     justOne: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数query:可选，删除的文档的条件</p>
</li>
<li><p>参数justOne:可选，如果设为true或1，则只删除一条，默认false，表示删除多条</p>
</li>
<li><p>例8：只删除匹配到的第一条 <code>db.stu.remove({gender:0},{justOne:true})</code></p>
</li>
<li><p>例9：全部删除 <code>db.stu.remove({})</code></p>
</li>
</ul>
</li>
<li><p>关于size的示例</p>
<ul>
<li>创建集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(&apos;sub&apos;,&#123;capped:true,size:10&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>插入第一条数据库查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.sub.insert(&#123;title:&apos;linux&apos;,count:10&#125;)</span><br><span class="line">db.sub.find()</span><br></pre></td></tr></table></figure>
<ul>
<li>插入第二条数据库查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.sub.insert(&#123;title:&apos;web&apos;,count:15&#125;)</span><br><span class="line">db.sub.find()</span><br></pre></td></tr></table></figure>
<ul>
<li>插入第三条数据库查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.sub.insert(&#123;title:&apos;sql&apos;,count:8&#125;)</span><br><span class="line">db.sub.find()</span><br></pre></td></tr></table></figure>
<ul>
<li>插入第四条数据库查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.sub.insert(&#123;title:&apos;django&apos;,count:12&#125;)</span><br><span class="line">db.sub.find()</span><br></pre></td></tr></table></figure>
<ul>
<li>插入第五条数据库查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.sub.insert(&#123;title:&apos;python&apos;,count:14&#125;)</span><br><span class="line">db.sub.find()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="1-6-数据查询"><a href="#1-6-数据查询" class="headerlink" title="1.6-数据查询"></a>1.6-数据查询</h3><ul>
<li><p>基本查询</p>
<ul>
<li><p>方法find()：查询</p>
<p><code>db.集合名称.find({条件文档})</code></p>
</li>
<li><p>方法findOne()：查询，只返回第一个</p>
<p><code>db.集合名称.findOne({条件文档})</code></p>
</li>
<li><p>方法pretty()：将结果格式化</p>
<p><code>db.集合名称.find({条件文档}).pretty()</code></p>
</li>
</ul>
</li>
<li><p>比较运算符</p>
<ul>
<li><p>等于，默认是等于判断，没有运算符</p>
</li>
<li><p>小于$lt</p>
</li>
<li><p>小于或等于$lte</p>
</li>
<li><p>大于$gt</p>
</li>
<li><p>大于或等于$gte</p>
</li>
<li><p>不等于$ne</p>
</li>
<li><p>例1：查询名称等于’gj’的学生</p>
<p><code>db.stu.find({name:&#39;gj&#39;})</code></p>
</li>
<li><p>例2：查询年龄大于或等于18的学生</p>
<p><code>db.stu.find({age:{$gte:18}})</code></p>
</li>
</ul>
</li>
<li><p>逻辑运算符</p>
<ul>
<li><p>查询时可以有多个条件，多个条件之间需要通过逻辑运算符连接</p>
</li>
<li><p>逻辑与：默认是逻辑与的关系</p>
<ul>
<li><p>例3：查询年龄大于或等于18，并且性别为1的学生</p>
<p><code>db.stu.find({age:{$gte:18},gender:1})</code></p>
</li>
</ul>
</li>
<li><p>逻辑或：使用$or</p>
<ul>
<li><p>例4：查询年龄大于18，或性别为0的学生</p>
<p><code>db.stu.find({$or:[{age:{$gt:18}},{gender:1}]})</code></p>
</li>
</ul>
</li>
<li><p>and和or一起使用</p>
<ul>
<li><p>例5：查询年龄大于18或性别为0的学生，并且学生的姓名为gj</p>
<p><code>db.stu.find({$or:[{age:{$gte:18}},{gender:1}],name:&#39;gj&#39;})</code></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>范围运算符</p>
<ul>
<li><p>使用”in”，”nin” 判断是否在某个范围内</p>
</li>
<li><p>例6：查询年龄为18、28的学生</p>
<p><code>db.stu.find({age:{$in:[18,28]}})</code></p>
</li>
</ul>
</li>
<li><p>支持正则表达式</p>
<ul>
<li><p>使用//或$regex编写正则表达式</p>
</li>
<li><p>例7：查询姓黄的学生</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.stu.find(&#123;name:/^黄/&#125;)</span><br><span class="line">db.stu.find(&#123;name:&#123;$regex:&apos;^黄&apos;&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>自定义查询</p>
<ul>
<li><p>使用$where后面写一个函数，返回满足条件的数据</p>
</li>
<li><p>例7：查询年龄大于30的学生</p>
<p><code>db.stu.find({$where:function(){return this.age&gt;20}})</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="1-6-1-Limit与Skip"><a href="#1-6-1-Limit与Skip" class="headerlink" title="1.6.1-Limit与Skip"></a>1.6.1-Limit与Skip</h4><ul>
<li><p>方法limit()：用于读取指定数量的文档</p>
<ul>
<li><p>语法：<code>db.集合名称.find().limit(NUMBER)</code></p>
</li>
<li><p>参数NUMBER表示要获取文档的条数</p>
</li>
<li><p>如果没有指定参数则显示集合中的所有文档</p>
</li>
<li><p>例1：查询2条学生信息</p>
<p><code>db.stu.find().limit(2)</code></p>
</li>
</ul>
</li>
<li><p>方法skip()：用于跳过指定数量的文档</p>
<ul>
<li><p>语法：<code>db.集合名称.find().skip(NUMBER)</code></p>
</li>
<li><p>参数NUMBER表示跳过的记录条数，默认值为0</p>
</li>
<li><p>例2：查询从第3条开始的学生信息</p>
<p><code>db.stu.find().skip(2)</code></p>
</li>
</ul>
</li>
<li><p>方法limit()和skip()可以一起使用，不分先后顺序</p>
<ul>
<li><p>创建数据集</p>
<p><code>for(i=0;i&lt;15;i++){db.t1.insert({_id:i})}</code></p>
</li>
<li><p>查询第5至8条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.stu.find().limit(4).skip(5)</span><br><span class="line">或</span><br><span class="line">db.stu.find().skip(5).limit(4)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="1-6-2-投影"><a href="#1-6-2-投影" class="headerlink" title="1.6.2-投影"></a>1.6.2-投影</h4><ul>
<li><p>在查询到的返回结果中，只选择必要的字段，而不是选择一个文档的整个字段</p>
</li>
<li><p>如：一个文档有5个字段，需要显示只有3个，投影其中3个字段即可</p>
</li>
<li><p>语法： 参数为字段与值，值为1表示显示，值为0不显示</p>
<p><code>db.集合名称.find({},{字段名称:1,...})</code></p>
</li>
<li><p>对于需要显示的字段，设置为1即可，不设置即为不显示</p>
</li>
<li><p>特殊：对于_id列默认是显示的，如果不显示需要明确设置为0</p>
</li>
<li><p>例1 <code>db.stu.find({},{name:1,gender:1})</code></p>
</li>
<li><p>例2 <code>db.stu.find({},{_id:0,name:1,gender:1})</code></p>
</li>
</ul>
<h4 id="1-6-3-排序"><a href="#1-6-3-排序" class="headerlink" title="1.6.3-排序"></a>1.6.3-排序</h4><ul>
<li><p>方法sort()，用于对结果集进行排序</p>
</li>
<li><p>语法</p>
</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find().sort(&#123;字段:1,...&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>参数1为升序排列</li>
<li>参数-1为降序排列</li>
</ul>
<ul>
<li>例1：根据性别降序，再根据年龄升序 <code>db.stu.find().sort({gender:-1,age:1})</code></li>
</ul>
<h4 id="1-6-4-统计个数"><a href="#1-6-4-统计个数" class="headerlink" title="1.6.4-统计个数"></a>1.6.4-统计个数</h4><ul>
<li>方法count()用于统计结果集中文档条数</li>
<li>语法 <code>db.集合名称.find({条件}).count()</code></li>
<li>也可以与为 <code>db.集合名称.count({条件})</code></li>
<li>例1：统计男生人数 <code>db.stu.find({gender:1}).count()</code></li>
<li>例2：统计年龄大于20的男生人数 <code>db.stu.count({age:{$gt:20},gender:1})</code></li>
</ul>
<h4 id="1-6-5-消除重复"><a href="#1-6-5-消除重复" class="headerlink" title="1.6.5-消除重复"></a>1.6.5-消除重复</h4><ul>
<li>方法distinct()对数据进行去重</li>
<li>语法 <code>db.集合名称.distinct(&#39;去重字段&#39;,{条件})</code></li>
<li>例1:查找年龄大于18的性别（去重） <code>db.stu.distinct(&#39;gender&#39;,{age:{$gt:18}})</code></li>
</ul>
<h3 id="1-7-总结"><a href="#1-7-总结" class="headerlink" title="1.7-总结"></a>1.7-总结</h3><ul>
<li>安装</li>
<li>数据库创建、删除</li>
<li>集合创建、删除</li>
<li>文档增加、修改、删除</li>
<li>文档查询：find(),limit(),skip(),投影,sort(),count(),distinct()</li>
</ul>
<h2 id="02-高级操作"><a href="#02-高级操作" class="headerlink" title="02-高级操作"></a>02-高级操作</h2><ul>
<li>讲解关于mongodb的高级操作，包括聚合、主从复制、分片、备份与恢复、MR</li>
<li>完成python与mongodb的交互</li>
</ul>
<h3 id="2-1-聚合aggregate"><a href="#2-1-聚合aggregate" class="headerlink" title="2.1-聚合aggregate"></a>2.1-聚合aggregate</h3><ul>
<li><p>聚合</p>
<ul>
<li><p>聚合(aggregate)主要用于计算数据，类似sql中的sum()、avg()</p>
</li>
<li><p>语法</p>
<p><code>db.集合名称.aggregate([{管道:{表达式}}])</code></p>
</li>
</ul>
</li>
<li><p>管道</p>
<ul>
<li><p>管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的输入</p>
<p><code>ps ajx | grep mongo</code></p>
</li>
<li><p>在mongodb中，管道具有同样的作用，文档处理完毕后，通过管道进行下一次处理</p>
</li>
<li><p>常用管道</p>
<ul>
<li>$group：将集合中的文档分组，可用于统计结果</li>
<li>$match：过滤数据，只输出符合条件的文档</li>
<li>$project：修改输入文档的结构，如重命名、增加、删除字段、创建计算结果</li>
<li>$sort：将输入文档排序后输出</li>
<li>$limit：限制聚合管道返回的文档数</li>
<li>$skip：跳过指定数量的文档，并返回余下的文档</li>
<li>$unwind：将数组类型的字段进行拆分</li>
</ul>
</li>
</ul>
</li>
<li><p>表达式</p>
<ul>
<li>处理输入文档并输出</li>
<li>语法 <code>表达式:&#39;$列名&#39;</code></li>
<li>常用表达式<ul>
<li>$sum：计算总和，$sum:1同count表示计数</li>
<li>$avg：计算平均值</li>
<li>$min：获取最小值</li>
<li>$max：获取最大值</li>
<li>$push：在结果文档中插入值到一个数组中</li>
<li>$first：根据资源文档的排序获取第一个文档数据</li>
<li>$last：根据资源文档的排序获取最后一个文档数据</li>
</ul>
</li>
</ul>
</li>
<li><p>$group</p>
<ul>
<li><p>将集合中的文档分组，可用于统计结果</p>
</li>
<li><p>_id表示分组的依据，使用某个字段的格式为’$字段’</p>
</li>
<li><p>例1：统计男生、女生的总人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:</span><br><span class="line">        &#123;</span><br><span class="line">            _id:&apos;$gender&apos;,</span><br><span class="line">            counter:&#123;$sum:1&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Group by null</p>
<ul>
<li><p>将集合中所有文档分为一组</p>
</li>
<li><p>例2：求学生总人数、平均年龄</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:</span><br><span class="line">        &#123;</span><br><span class="line">            _id:null,</span><br><span class="line">            counter:&#123;$sum:1&#125;,</span><br><span class="line">            avgAge:&#123;$avg:&apos;$age&apos;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>透视数据</p>
<ul>
<li><p>例3：统计学生性别及学生姓名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:</span><br><span class="line">        &#123;</span><br><span class="line">            _id:&apos;$gender&apos;,</span><br><span class="line">            name:&#123;$push:&apos;$name&apos;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用$$ROOT可以将文档内容加入到结果集的数组中，代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:</span><br><span class="line">        &#123;</span><br><span class="line">            _id:&apos;$gender&apos;,</span><br><span class="line">            name:&#123;$push:&apos;$$ROOT&apos;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>$match</p>
<ul>
<li><p>用于过滤数据，只输出符合条件的文档</p>
</li>
<li><p>使用MongoDB的标准查询操作</p>
</li>
<li><p>例1：查询年龄大于20的学生</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$match:&#123;age:&#123;$gt:20&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
<li><p>例2：查询年龄大于20的男生、女生人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$match:&#123;age:&#123;$gt:20&#125;&#125;&#125;,</span><br><span class="line">    &#123;$group:&#123;_id:&apos;$gender&apos;,counter:&#123;$sum:1&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>$project</p>
<ul>
<li><p>修改输入文档的结构，如重命名、增加、删除字段、创建计算结果</p>
</li>
<li><p>例1：查询学生的姓名、年龄</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$project:&#123;_id:0,name:1,age:1&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
<li><p>例2：查询男生、女生人数，输出人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:&#123;_id:&apos;$gender&apos;,counter:&#123;$sum:1&#125;&#125;&#125;,</span><br><span class="line">    &#123;$project:&#123;_id:0,counter:1&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>$sort</p>
<ul>
<li><p>将输入文档排序后输出</p>
</li>
<li><p>例1：查询学生信息，按年龄升序</p>
<p><code>b.stu.aggregate([{$sort:{age:1}}])</code></p>
</li>
<li><p>例2：查询男生、女生人数，按人数降序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:&#123;_id:&apos;$gender&apos;,counter:&#123;$sum:1&#125;&#125;&#125;,</span><br><span class="line">    &#123;$sort:&#123;counter:-1&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>$limit</p>
<ul>
<li>限制聚合管道返回的文档数</li>
<li>例1：查询2条学生信息 <code>db.stu.aggregate([{$limit:2}])</code></li>
</ul>
</li>
<li><p>$skip</p>
<ul>
<li><p>跳过指定数量的文档，并返回余下的文档</p>
</li>
<li><p>例2：查询从第3条开始的学生信息 <code>db.stu.aggregate([{$skip:2}])</code></p>
</li>
<li><p>例3：统计男生、女生人数，按人数升序，取第二条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate([</span><br><span class="line">    &#123;$group:&#123;_id:&apos;$gender&apos;,counter:&#123;$sum:1&#125;&#125;&#125;,</span><br><span class="line">    &#123;$sort:&#123;counter:1&#125;&#125;,</span><br><span class="line">    &#123;$skip:1&#125;,</span><br><span class="line">    &#123;$limit:1&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意顺序：先写skip，再写limit</p>
</li>
</ul>
</li>
<li><p>$unwind</p>
<ul>
<li><p>将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值</p>
</li>
<li><p>语法1</p>
<ul>
<li>对某字段值进行拆分 <code>db.集合名称.aggregate([{$unwind:&#39;$字段名称&#39;}])</code></li>
<li>构造数据 <code>db.t2.insert({_id:1,item:&#39;t-shirt&#39;,size:[&#39;S&#39;,&#39;M&#39;,&#39;L&#39;]})</code></li>
<li>查询 <code>db.t2.aggregate([{$unwind:&#39;$size&#39;}])</code></li>
</ul>
</li>
<li><p>语法2</p>
<ul>
<li><p>对某字段值进行拆分</p>
</li>
<li><p>处理空数组、非数组、无字段、null情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.aggregate([&#123;</span><br><span class="line">    $unwind:&#123;</span><br><span class="line">        path:&apos;$字段名称&apos;,</span><br><span class="line">        preserveNullAndEmptyArrays:&lt;boolean&gt;#防止数据丢失</span><br><span class="line">    &#125;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.t3.insert([</span><br><span class="line">&#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;a&quot;, &quot;size&quot;: [ &quot;S&quot;, &quot;M&quot;, &quot;L&quot;] &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;b&quot;, &quot;size&quot; : [ ] &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;c&quot;, &quot;size&quot;: &quot;M&quot; &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;d&quot; &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;e&quot;, &quot;size&quot; : null &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用语法1查询 <code>db.t3.aggregate([{$unwind:&#39;$size&#39;}])</code></p>
</li>
<li><p>查看查询结果，发现对于空数组、无字段、null的文档，都被丢弃了</p>
<ul>
<li><p>问：如何能不丢弃呢？</p>
</li>
<li><p>答：使用语法2查询</p>
<p><code>db.t3.aggregate([{$unwind:{path:&#39;$sizes&#39;,preserveNullAndEmptyArrays:true}}])</code></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-2-安全"><a href="#2-2-安全" class="headerlink" title="2.2-安全"></a>2.2-安全</h3><ul>
<li><p>超级管理员</p>
<ul>
<li><p>为了更安全的访问mongodb，需要访问者提供用户名和密码，于是需要在mongodb中创建用户</p>
</li>
<li><p>采用了角色-用户-数据库的安全管理方式</p>
</li>
<li><p>常用系统角色如下：</p>
<ul>
<li>root：只在admin数据库中可用，超级账号，超级权限</li>
<li>Read：允许用户读取指定数据库</li>
<li>readWrite：允许用户读写指定数据库</li>
</ul>
</li>
<li><p>创建超级管理用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">    user:&apos;admin&apos;,</span><br><span class="line">    pwd:&apos;123&apos;,</span><br><span class="line">    roles:[&#123;role:&apos;root&apos;,db:&apos;admin&apos;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>启用安全认证</p>
<ul>
<li><p>修改配置文件 <code>sudo vi /etc/mongod.conf</code></p>
</li>
<li><p>启用身份验证</p>
</li>
<li><p>注意：keys and values之间一定要加空格, 否则解析会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service mongod stop</span><br><span class="line">sudo service mongod start</span><br></pre></td></tr></table></figure>
</li>
<li><p>终端连接 <code>mongo -u &#39;admin&#39; -p &#39;123&#39; --authenticationDatabase &#39;admin&#39;</code></p>
</li>
</ul>
</li>
<li><p>普通用户管理</p>
<ul>
<li><p>使用超级管理员登录，然后进入用户管理操作</p>
</li>
<li><p>查看当前数据库的用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use test1</span><br><span class="line">show users</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建普通用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(&#123;</span><br><span class="line">    user:&apos;t1&apos;,</span><br><span class="line">    pwd:&apos;123&apos;,</span><br><span class="line">    roles:[&#123;role:&apos;readWrite&apos;,db:&apos;test1&apos;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>终端连接 <code>mongo -u t1 -p 123 --authenticationDatabase test1</code></p>
</li>
<li><p>切换数据库，执行命令查看效果</p>
</li>
<li><p>修改用户：可以修改pwd、roles属性</p>
<p><code>db.updateUser(&#39;t1&#39;,{pwd:&#39;456&#39;})</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="2-3-复制（副本集"><a href="#2-3-复制（副本集" class="headerlink" title="2.3-复制（副本集"></a>2.3-复制（副本集</h3><ul>
<li><p>什么是复制</p>
<ul>
<li>复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性，并可以保证数据的安全性</li>
<li>复制还允许从硬件故障和服务中断中恢复数据</li>
</ul>
</li>
<li><p>为什么要复制</p>
<ul>
<li>数据备份</li>
<li>数据灾难恢复</li>
<li>读写分离</li>
<li>高（24* 7）数据可用性</li>
<li>无宕机维护</li>
<li>副本集对应用程序是透明</li>
</ul>
</li>
<li><p>复制的工作原理</p>
<ul>
<li>复制至少需要两个节点A、B…</li>
<li>A是主节点，负责处理客户端请求</li>
<li>其余的都是从节点，负责复制主节点上的数据</li>
<li>节点常见的搭配方式为：一主一从、一主多从</li>
<li>主节点记录在其上的所有操作，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致</li>
<li>主节点与从节点进行数据交互保障数据的一致性</li>
</ul>
</li>
<li><p>复制的特点</p>
<ul>
<li>N 个节点的集群</li>
<li>任何节点可作为主节点</li>
<li>所有写入操作都在主节点上</li>
<li>自动故障转移</li>
<li>自动恢复</li>
</ul>
</li>
<li><p>设置复制节点</p>
<ul>
<li><p>接下来的操作需要打开多个终端窗口，而且可能会连接多台ubuntu主机，会显得有些乱，建议在xshell中实现</p>
</li>
<li><p>step1:创建数据库目录t1、t2</p>
<p>在Desktop目录下演示，其它目录也可以，注意权限即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir t1</span><br><span class="line">mkdir t2</span><br></pre></td></tr></table></figure>
</li>
<li><p>step2:使用如下格式启动mongod，注意replSet的名称是一致的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongod --bind_ip 192.168.196.128 --port 27017 --dbpath ~/Desktop/t1 --replSet rs0</span><br><span class="line">mongod --bind_ip 192.168.196.128 --port 27018 --dbpath ~/Desktop/t2 --replSet rs0</span><br></pre></td></tr></table></figure>
</li>
<li><p>step3:连接主服务器，此处设置192.168.196.128:27017为主服务器</p>
<p><code>mongo --host 192.168.196.128 --port 27017</code></p>
</li>
<li><p>step4:初始化 <code>rs.initiate()</code></p>
</li>
<li><p>step5:查看当前状态 <code>rs.status()</code></p>
<p>当前状态如下图：</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-5/24075422.jpg?ynotemdtimestamp=1550481900183" alt="img"></p>
</li>
<li><p>step6:添加复本集 <code>rs.add(&#39;192.168.196.128:27018&#39;)</code></p>
</li>
<li><p>step7:复本集添加成功后，当前状态如下图：</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-5/78041419.jpg?ynotemdtimestamp=1550481900183" alt="img"></p>
</li>
<li><p>step8:连接第二个mongo服务 <code>mongo --host 192.168.196.128 --port 27018</code></p>
</li>
<li><p>step9:向主服务器中插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use test1</span><br><span class="line">for(i=0;i&lt;10;i++)&#123;db.t1.insert(&#123;_id:i&#125;)&#125;</span><br><span class="line">db.t1.find()</span><br></pre></td></tr></table></figure>
</li>
<li><p>step10:在从服务器中插查询 说明：如果在从服务器上进行读操作，需要设置rs.slaveOk()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rs.slaveOk()</span><br><span class="line">db.t1.find()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>其它说明</p>
<ul>
<li>删除从节点 <code>rs.remove(&#39;192.168.196.128:27018&#39;)</code></li>
<li>关闭主服务器后，再重新启动，会发现原来的从服务器变为了从服务器，新启动的服务器（原来的从服务器）变为了从服务器</li>
</ul>
</li>
</ul>
<h3 id="2-4-备份与恢复"><a href="#2-4-备份与恢复" class="headerlink" title="2.4-备份与恢复"></a>2.4-备份与恢复</h3><ul>
<li><p>备份</p>
<ul>
<li><p>语法 <code>mongodump -h dbhost -d dbname -o dbdirectory</code></p>
</li>
<li><p>-h：服务器地址，也可以指定端口号</p>
</li>
<li><p>-d：需要备份的数据库名称</p>
</li>
<li><p>-o：备份的数据存放位置，此目录中存放着备份出来的数据</p>
</li>
<li><p>例1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir test1bak</span><br><span class="line">sudo mongodump -h 192.168.196.128:27017 -d test1 -o ~/Desktop/test1bak</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>恢复</p>
<ul>
<li>语法 <code>mongorestore -h dbhost -d dbname --dir dbdirectory</code></li>
<li>-h：服务器地址</li>
<li>-d：需要恢复的数据库实例</li>
<li>–dir：备份数据所在位置</li>
<li>例2 <code>mongorestore -h 192.168.196.128:27017 -d test2 --dir ~/Desktop/test1bak/test1</code></li>
</ul>
</li>
</ul>
<h3 id="2-5-与python交互"><a href="#2-5-与python交互" class="headerlink" title="2.5-与python交互"></a>2.5-与python交互</h3><ul>
<li><p>点击查看<a href="http://api.mongodb.org/python/current/tutorial.html" target="_blank" rel="noopener">官方文档</a></p>
</li>
<li><p>安装python包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">进入虚拟环境</span><br><span class="line">sudo pip install pymongo</span><br><span class="line">或源码安装</span><br><span class="line">python setup.py</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入包pymongo <code>import pymongo</code></p>
</li>
<li><p>连接，创建客户端 <code>client=pymongo.MongoClient(&quot;localhost&quot;, 27017)</code></p>
</li>
<li><p>获得数据库test1 <code>db=client.test1</code></p>
</li>
<li><p>获得集合stu <code>stu = db.stu</code></p>
</li>
<li><p>添加文档 <code>s1={name:&#39;gj&#39;,age:18}`</code>s1_id = stu.insert_one(s1).inserted_id`</p>
</li>
<li><p>查找一个文档 <code>s2=stu.find_one()</code></p>
</li>
<li><p>查找多个文档1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for cur in stu.find():</span><br><span class="line">    print cur</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找多个文档2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cur=stu.find()</span><br><span class="line">cur.next()</span><br><span class="line">cur.next()</span><br><span class="line">cur.next()</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取文档个数 <code>print stu.count()</code></p>
</li>
</ul>
<h3 id="2-6-总结"><a href="#2-6-总结" class="headerlink" title="2.6-总结"></a>2.6-总结</h3><ul>
<li>聚合</li>
<li>安全</li>
<li>副本集</li>
<li>备份与恢复</li>
<li>与python交互</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"># python</a>
          
            <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/18/服务器相关安全设置/" rel="next" title="服务器相关安全设置">
                <i class="fa fa-chevron-left"></i> 服务器相关安全设置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/19/python-MySQL/" rel="prev" title="python-MySQL">
                python-MySQL <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ry1ynn">
            
              <p class="site-author-name" itemprop="name">Ry1ynn</p>
              <p class="site-description motion-element" itemprop="description">我们的征途是星辰大海</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">118</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">53</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ry1ynn" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ry1ynn_pri@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/5794121667" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="/images/weixin.JPG" target="_blank" title="Wechat">
                      
                        <i class="fa fa-fw fa-weixin"></i>Wechat</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.t00ls.net/" title="T00ls" target="_blank">T00ls</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.freebuf.com/" title="FreeBuf" target="_blank">FreeBuf</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.sec-wiki.com/" title="SecWiki" target="_blank">SecWiki</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.seebug.org/" title="Seebug" target="_blank">Seebug</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.91ri.org/" title="91Ri" target="_blank">91Ri</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.pediy.com/" title="看雪" target="_blank">看雪</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.52pojie.cn/" title="吾爱破解" target="_blank">吾爱破解</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.anquanke.com/" title="安全客" target="_blank">安全客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.ichunqiu.com/" title="i春秋" target="_blank">i春秋</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MongoDB"><span class="nav-text">MongoDB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#00-简介"><span class="nav-text">00-简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#01-基本操作"><span class="nav-text">01-基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-环境安装"><span class="nav-text">1.1-环境安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-数据库操作"><span class="nav-text">1.2-数据库操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-集合操作"><span class="nav-text">1.3-集合操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-数据类型"><span class="nav-text">1.4-数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-数据操作"><span class="nav-text">1.5-数据操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-数据查询"><span class="nav-text">1.6-数据查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-1-Limit与Skip"><span class="nav-text">1.6.1-Limit与Skip</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-2-投影"><span class="nav-text">1.6.2-投影</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-3-排序"><span class="nav-text">1.6.3-排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-4-统计个数"><span class="nav-text">1.6.4-统计个数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-5-消除重复"><span class="nav-text">1.6.5-消除重复</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-7-总结"><span class="nav-text">1.7-总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#02-高级操作"><span class="nav-text">02-高级操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-聚合aggregate"><span class="nav-text">2.1-聚合aggregate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-安全"><span class="nav-text">2.2-安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-复制（副本集"><span class="nav-text">2.3-复制（副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-备份与恢复"><span class="nav-text">2.4-备份与恢复</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-与python交互"><span class="nav-text">2.5-与python交互</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-总结"><span class="nav-text">2.6-总结</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ry1ynn</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  










  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script id="ribbon" type="text/javascript" size="300" alpha="0.5" zindex="0" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
