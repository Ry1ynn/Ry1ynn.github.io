<!DOCTYPE html>



  



<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">






  <meta name="keywords" content="python,MySQL,">










<meta name="description" content="MySQL相关00-简介 mysql数据库，是当前应用非常广泛的一款关系型数据库 查看官方网站 查看数据库排名 主要知识点包括： 数据库与表的操作 数据的增加、修改、删除 数据的查询（重点）">
<meta name="keywords" content="python,MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="python-MySQL">
<meta property="og:url" content="http://21guns.top/2017/11/19/python-MySQL/index.html">
<meta property="og:site_name" content="Ry1ynn&#39;s blogs">
<meta property="og:description" content="MySQL相关00-简介 mysql数据库，是当前应用非常广泛的一款关系型数据库 查看官方网站 查看数据库排名 主要知识点包括： 数据库与表的操作 数据的增加、修改、删除 数据的查询（重点）">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-5/15636253.jpg?ynotemdtimestamp=1550481878480">
<meta property="og:updated_time" content="2019-02-18T09:27:13.040Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python-MySQL">
<meta name="twitter:description" content="MySQL相关00-简介 mysql数据库，是当前应用非常广泛的一款关系型数据库 查看官方网站 查看数据库排名 主要知识点包括： 数据库与表的操作 数据的增加、修改、删除 数据的查询（重点）">
<meta name="twitter:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-5/15636253.jpg?ynotemdtimestamp=1550481878480">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://21guns.top/2017/11/19/python-MySQL/">





  <title>python-MySQL | Ry1ynn's blogs</title>
  










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ry1ynn's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://21guns.top/2017/11/19/python-MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ry1ynn">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ry1ynn's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">python-MySQL</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-19T17:24:08+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/数据库相关/" itemprop="url" rel="index">
                    <span itemprop="name">数据库相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="MySQL相关"><a href="#MySQL相关" class="headerlink" title="MySQL相关"></a>MySQL相关</h1><h2 id="00-简介"><a href="#00-简介" class="headerlink" title="00-简介"></a>00-简介</h2><ul>
<li>mysql数据库，是当前应用非常广泛的一款关系型数据库</li>
<li>查看<a href="http://www.mysql.com/" target="_blank" rel="noopener">官方网站</a></li>
<li>查看<a href="http://db-engines.com/en/ranking" target="_blank" rel="noopener">数据库排名</a></li>
<li>主要知识点包括：<ul>
<li>数据库与表的操作</li>
<li>数据的增加、修改、删除</li>
<li>数据的查询（重点）<a id="more"></a></li>
<li>与python交互</li>
</ul>
</li>
</ul>
<h2 id="01-创建库和表"><a href="#01-创建库和表" class="headerlink" title="01-创建库和表"></a>01-创建库和表</h2><ul>
<li>主要知识点包括：能够与mysql建立连接，创建数据库、表，分别从图形界面与脚本界面两个方面讲解</li>
<li>相关的知识点包括：E-R关系模型，数据库的3范式，mysql中数据字段的类型，字段约束</li>
<li>数据库的操作主要包括：<ul>
<li>数据库的操作，包括创建、删除</li>
<li>表的操作，包括创建、修改、删除</li>
<li>数据的操作，包括增加、修改、删除、查询，简称crud</li>
</ul>
</li>
<li>学生表结构：<ul>
<li>id</li>
<li>名称</li>
<li>性别</li>
<li>地址</li>
<li>生日</li>
</ul>
</li>
<li>科目表结构：<ul>
<li>id</li>
<li>名称</li>
</ul>
</li>
</ul>
<h3 id="1-1-数据库简介"><a href="#1-1-数据库简介" class="headerlink" title="1.1-数据库简介"></a>1.1-数据库简介</h3><ul>
<li>数据库简介<ul>
<li>人类在进化的过程中，创造了数字、文字、符号等来进行数据的记录，但是承受着认知能力和创造能力的提升，数据量越来越大，对于数据的记录和准确查找，成为了一个重大难题</li>
<li>计算机诞生后，数据开始在计算机中存储并计算，并设计出了数据库系统</li>
<li>数据库系统解决的问题：持久化存储，优化读写，保证数据的有效性</li>
<li>当前使用的数据库，主要分为两类<ul>
<li>文档型，如sqlite，就是一个文件，通过对文件的复制完成数据库的复制</li>
<li>服务型，如mysql、postgre，数据存储在一个物理文件中，但是需要使用终端以tcp/ip协议连接，进行数据库的读写操作</li>
</ul>
</li>
</ul>
</li>
<li>E-R模型<ul>
<li>当前物理的数据库都是按照E-R模型进行设计的</li>
<li>E表示entry，实体</li>
<li>R表示relationship，关系</li>
<li>一个实体转换为数据库中的一个表</li>
<li>关系描述两个实体之间的对应规则，包括<ul>
<li>一对一</li>
<li>一对多</li>
<li>多对多</li>
</ul>
</li>
<li>关系转换为数据库表中的一个列 *在关系型数据库中一行就是一个对象</li>
</ul>
</li>
<li>三范式<ul>
<li>经过研究和对使用中问题的总结，对于设计数据库提出了一些规范，这些规范被称为范式</li>
<li>第一范式（1NF)：列不可拆分</li>
<li>第二范式（2NF)：唯一标识</li>
<li>第三范式（3NF)：引用主键</li>
<li>说明：后一个范式，都是在前一个范式的基础上建立的</li>
</ul>
</li>
</ul>
<h3 id="1-2-安装管理"><a href="#1-2-安装管理" class="headerlink" title="1.2-安装管理"></a>1.2-安装管理</h3><ul>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server mysql-client</span><br><span class="line">然后按照提示输入</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理服务</p>
<ul>
<li>启动 <code>service mysql start</code></li>
<li>停止 <code>service mysql stop</code></li>
<li>重启 <code>service mysql restart</code></li>
</ul>
</li>
<li><p>允许远程连接</p>
<ul>
<li><p>找到mysql配置文件并修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line">将bind-address=127.0.0.1注释</span><br></pre></td></tr></table></figure>
</li>
<li><p>登录mysql，运行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;mysql&apos; with grant option;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启mysql</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-3-数据完整性"><a href="#1-3-数据完整性" class="headerlink" title="1.3-数据完整性"></a>1.3-数据完整性</h3><ul>
<li>数据完整性<ul>
<li>一个数据库就是一个完整的业务单元，可以包含多张表，数据被存储在表中</li>
<li>在表中为了更加准确的存储数据，保证数据的正确有效，可以在创建表的时候，为表添加一些强制性的验证，包括数据字段的类型、约束</li>
</ul>
</li>
<li>字段类型<ul>
<li>在mysql中包含的数据类型很多，这里主要列出来常用的几种</li>
<li>数字：int,decimal</li>
<li>字符串：varchar,text</li>
<li>日期：datetime</li>
<li>布尔：bit</li>
</ul>
</li>
<li>约束<ul>
<li>主键primary key</li>
<li>非空not null</li>
<li>惟一unique</li>
<li>默认default</li>
<li>外键foreign key</li>
</ul>
</li>
</ul>
<h3 id="1-4-图形窗口操作"><a href="#1-4-图形窗口操作" class="headerlink" title="1.4-图形窗口操作"></a>1.4-图形窗口操作</h3><ul>
<li>使用图形窗口连接<ul>
<li>下发windows的navicat</li>
<li>点击“连接”弹出窗口，按照提示填写连接信息</li>
<li>连接成功后，会在连接名称下面显示出当前的数据库</li>
<li>双击选中数据库，就可以编辑此数据库</li>
<li>下次再进入此软件时，通过双击完成连接、编辑操作</li>
</ul>
</li>
<li>数据库操作<ul>
<li>在连接的名称上右击，选择“新建数据库”，弹出窗口，并按提示填写</li>
<li>在数据库上右击，选择“删除数据库”可以完成删除操作</li>
</ul>
</li>
<li>表操作<ul>
<li>当数据库显示为高亮时，表示当前操作此数据库，可以在数据中创建表</li>
<li>一个实体对应一张表，用于存储特定结构的数据</li>
<li>点击“新建表”，弹出窗口，按提示填写信息</li>
<li>主键的名称一般为id，设置为int型，无符号数，自动增长，非空</li>
<li>自动增长表示由mysql系统负责维护这个字段的值，不需要手动维护，所以不用关心这个字段的具体值</li>
<li>字符串varchar类型需要设置长度，即最多包含多少个字符</li>
<li>点击“添加栏位”，可以添加一个新的字段</li>
<li>点击“保存”，为表定义名称</li>
</ul>
</li>
<li>数据操作<ul>
<li>表创建成功后，可以在右侧看到，双击表打开新窗口，如下图</li>
<li>在此窗口中可以增加、修改、删除数据</li>
</ul>
</li>
<li>逻辑删除<ul>
<li>对于重要数据，并不希望物理删除，一旦删除，数据无法找回</li>
<li>一般对于重要数据，会设置一个isDelete的列，类型为bit，表示逻辑删除</li>
<li>大于大量增长的非重要数据，可以进行物理删除</li>
<li>数据的重要性，要根据实际开发决定</li>
</ul>
</li>
</ul>
<h3 id="1-5-命令脚本操作"><a href="#1-5-命令脚本操作" class="headerlink" title="1.5-命令脚本操作"></a>1.5-命令脚本操作</h3><ul>
<li><p>使用命令连接</p>
<ul>
<li><p>命令操作方式，在工作中使用的更多一些，所以要达到熟练的程度</p>
</li>
<li><p>打开终端，运行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">回车后输入密码，当前设置的密码为mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接成功后如下图</p>
</li>
<li><p>退出登录 <code>quit或exit</code></p>
</li>
<li><p>登录成功后，输入如下命令查看效果 <code>查看版本：select version();`</code>显示当前时间：select now();`</p>
</li>
<li><p>注意：在语句结尾要使用分号;</p>
</li>
</ul>
</li>
<li><p>远程连接</p>
<ul>
<li><p>一般在公司开发中，可能会将数据库统一搭建在一台服务器上，所有开发人员共用一个数据库，而不是在自己的电脑中配置一个数据库</p>
</li>
<li><p>运行命令</p>
<p><code>mysql -hip地址 -uroot -p</code></p>
<ul>
<li>-h后面写要连接的主机ip地址</li>
<li>-u后面写连接的用户名</li>
<li>-p回车后写密码</li>
</ul>
</li>
</ul>
</li>
<li><p>数据库操作</p>
<ul>
<li>创建数据库 <code>create database 数据库名 charset=utf8;</code></li>
<li>删除数据库 <code>drop database 数据库名;</code></li>
<li>切换数据库 <code>use 数据库名;</code></li>
<li>查看当前选择的数据库 <code>select database();</code></li>
</ul>
</li>
<li><p>表操作</p>
<ul>
<li><p>查看当前数据库中所有表 <code>show tables;</code></p>
</li>
<li><p>创建表</p>
<p>auto_increment表示自动增长</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(列及类型);</span><br><span class="line">如：</span><br><span class="line">create table students(</span><br><span class="line">id int auto_increment primary key,</span><br><span class="line">sname varchar(10) not null</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add|change|drop 列名 类型;</span><br><span class="line">如：</span><br><span class="line">alter table students add birthday datetime;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除表 <code>drop table 表名;</code></p>
</li>
<li><p>查看表结构 <code>desc 表名;</code></p>
</li>
<li><p>更改表名称 <code>rename table 原表名 to 新表名;</code></p>
</li>
<li><p>查看表的创建语句 <code>show create table &#39;表名&#39;;</code></p>
</li>
</ul>
</li>
<li><p>数据操作</p>
<ul>
<li><p>查询 <code>select * from 表名</code></p>
</li>
<li><p>增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">全列插入：insert into 表名 values(...)</span><br><span class="line">缺省插入：insert into 表名(列1,...) values(值1,...)</span><br><span class="line">同时插入多条数据：insert into 表名 values(...),(...)...;</span><br><span class="line">或insert into 表名(列1,...) values(值1,...),(值1,...)...;</span><br></pre></td></tr></table></figure>
<p>主键列是自动增长，但是在全列插入时需要占位，通常使用0，插入成功后以实际数据为准</p>
</li>
<li><p>修改 <code>update 表名 set 列1=值1,... where 条件</code></p>
</li>
<li><p>删除 <code>delete from 表名 where 条件</code></p>
</li>
<li><p>逻辑删除，本质就是修改操作update</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table students add isdelete bit default 0;</span><br><span class="line">如果需要删除则</span><br><span class="line">update students isdelete=1 where ...;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>备份与恢复</p>
<ul>
<li><p>数据备份</p>
<ul>
<li><p>进入超级管理员 <code>sudo -s</code></p>
</li>
<li><p>进入mysql库目录 <code>cd /var/lib/mysql</code></p>
</li>
<li><p>运行mysqldump命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump –uroot –p 数据库名 &gt; ~/Desktop/备份文件.sql;</span><br><span class="line">按提示输入mysql的密码</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>数据恢复</p>
<ul>
<li><p>连接mysqk，创建数据库</p>
</li>
<li><p>退出连接，执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot –p 数据库名 &lt; ~/Desktop/备份文件.sql</span><br><span class="line">根据提示输入mysql密码</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-6-总结"><a href="#1-6-总结" class="headerlink" title="1.6-总结"></a>1.6-总结</h3><ul>
<li>数据库解决的问题，E-R模型，三范式</li>
<li>图形界面操作数据库、表、数据</li>
<li>命令行操作数据库、表、数据</li>
</ul>
<h2 id="02-查询"><a href="#02-查询" class="headerlink" title="02-查询"></a>02-查询</h2><ul>
<li><p>查询的基本语法</p>
<p><code>select * from 表名;</code></p>
<ul>
<li>from关键字后面写表名，表示数据来源于是这张表</li>
<li>select后面写表中的列名，如果是*表示在结果中显示表中所有列</li>
<li>在select后面的列名部分，可以使用as为列起别名，这个别名出现在结果集中</li>
<li>如果要查询多个列，之间使用逗号分隔</li>
</ul>
</li>
<li><p>在select后面列前使用distinct可以消除重复的行</p>
<p><code>select distinct gender from students;</code></p>
</li>
</ul>
<h3 id="2-1-条件"><a href="#2-1-条件" class="headerlink" title="2.1-条件"></a>2.1-条件</h3><ul>
<li><p>条件</p>
<ul>
<li>使用where子句对表中的数据筛选，结果为true的行会出现在结果集中</li>
<li>语法如下： <code>select * from 表名 where 条件;</code></li>
</ul>
</li>
<li><p>比较运算符</p>
<ul>
<li>等于= 大于&gt; 大于等于&gt;= 小于&lt; 小于等于&lt;= 不等于!=或&lt;&gt;</li>
<li>查询编号大于3的学生 <code>select * from students where id&gt;3;</code></li>
<li>查询编号不大于4的科目 <code>select * from subjects where id&lt;=4;</code></li>
<li>查询姓名不是“黄蓉”的学生 <code>select * from students where sname!=&#39;黄蓉&#39;;</code></li>
<li>查询没被删除的学生 <code>select * from students where isdelete=0;</code></li>
</ul>
</li>
<li><p>逻辑运算符</p>
<ul>
<li><p>and or not</p>
</li>
<li><p>查询编号大于3的女同学</p>
<p><code>select * from students where id&gt;3 and gender=0;</code></p>
</li>
<li><p>查询编号小于4或没被删除的学生</p>
<p><code>select * from students where id&lt;4 or isdelete=0;</code></p>
</li>
</ul>
</li>
<li><p>模糊查询</p>
<ul>
<li>like %表示任意多个任意字符 _表示一个任意字符</li>
<li>查询姓黄的学生 <code>select * from students where sname like &#39;黄%&#39;;</code></li>
<li>查询姓黄并且名字是一个字的学生 <code>select * from students where sname like &#39;黄_&#39;;</code></li>
<li>查询姓黄或叫靖的学生 <code>select * from students where sname like &#39;黄%&#39; or sname like &#39;%靖%&#39;;</code></li>
</ul>
</li>
<li><p>范围查询</p>
<ul>
<li><p>in表示在一个非连续的范围内</p>
<p>查询编号是1或3或8的学生 <code>select * from students where id in(1,3,8);</code></p>
</li>
<li><p>between … and …表示在一个连续的范围内</p>
<p>查询学生是3至8的学生 <code>select * from students where id between 3 and 8;</code></p>
</li>
<li><p>查询学生是3至8的男生</p>
<p><code>select * from students where id between 3 and 8 and gender=1;</code></p>
</li>
</ul>
</li>
<li><p>空判断</p>
<ul>
<li><p>注意：null与’’是不同的</p>
</li>
<li><p>判空is null</p>
<p>查询没有填写地址的学生 <code>select * from students where hometown is null;</code></p>
</li>
<li><p>判非空is not null 查询填写了地址的学生 <code>select * from students where hometown is not null;</code></p>
</li>
<li><p>查询填写了地址的女生</p>
<p><code>select * from students where hometown is not null and gender=0;</code></p>
</li>
</ul>
</li>
<li><p>优先级</p>
<ul>
<li>小括号，not，比较运算符，逻辑运算符</li>
<li>and比or先运算，如果同时出现并希望先算or，需要结合()使用</li>
</ul>
</li>
</ul>
<h3 id="2-2-聚合"><a href="#2-2-聚合" class="headerlink" title="2.2-聚合"></a>2.2-聚合</h3><ul>
<li>为了快速得到统计数据，提供了5个聚合函数</li>
<li>count(<em>)表示计算总行数，括号中写星与列名，结果是相同的 查询学生总数 `select count(</em>) from students;`</li>
<li>max(列)表示求此列的最大值 查询女生的编号最大值 <code>select max(id) from students where gender=0;</code></li>
<li>min(列)表示求此列的最小值 查询未删除的学生最小编号 <code>select min(id) from students where isdelete=0;</code></li>
<li>sum(列)表示求此列的和 查询男生的编号之后 <code>select sum(id) from students where gender=1;</code></li>
<li>avg(列)表示求此列的平均值 查询未删除女生的编号平均值 <code>select avg(id) from students where isdelete=0 and gender=0;</code></li>
</ul>
<h3 id="2-3-分组"><a href="#2-3-分组" class="headerlink" title="2.3-分组"></a>2.3-分组</h3><ul>
<li><p>分组</p>
<ul>
<li><p>按照字段分组，表示此字段相同的数据会被放到一个组中</p>
</li>
<li><p>分组后，只能查询出相同的数据列，对于有差异的数据列无法出现在结果集中</p>
</li>
<li><p>可以对分组后的数据进行统计，做聚合运算</p>
</li>
<li><p>语法： <code>select 列1,列2,聚合... from 表名 group by 列1,列2,列3...</code></p>
</li>
<li><p>查询各城市人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select hometown as 家乡,count(*)</span><br><span class="line">from students</span><br><span class="line">group by hometown;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询男女生总数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select gender as 性别,count(*)</span><br><span class="line">from students</span><br><span class="line">group by gender;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>分组后的数据筛选</p>
<ul>
<li><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select 列1,列2,聚合... from 表名</span><br><span class="line">group by 列1,列2,列3...</span><br><span class="line">having 列1,...聚合...</span><br></pre></td></tr></table></figure>
</li>
<li><p>having后面的条件运算符与where的相同</p>
</li>
<li><p>查询男生总人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">方案一</span><br><span class="line">select count(*)</span><br><span class="line">from students</span><br><span class="line">where gender=1;</span><br><span class="line">-----------------------------------</span><br><span class="line">方案二：</span><br><span class="line">select gender as 性别,count(*)</span><br><span class="line">from students</span><br><span class="line">group by gender</span><br><span class="line">having gender=1;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="2-4-排序"><a href="#2-4-排序" class="headerlink" title="2.4-排序"></a>2.4-排序</h3><ul>
<li><p>为了方便查看数据，可以对数据进行排序</p>
</li>
<li><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名</span><br><span class="line">order by 列1 asc|desc,列2 asc|desc,...</span><br></pre></td></tr></table></figure>
</li>
<li><p>将行数据按照列1进行排序，如果某些行列1的值相同时，则按照列2排序，以此类推</p>
</li>
<li><p>默认按照列值从小到大排列</p>
</li>
<li><p>asc从小到大排列，即升序</p>
</li>
<li><p>desc从大到小排序，即降序</p>
</li>
<li><p>查询未删除男生学生信息，按学号降序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from students</span><br><span class="line">where gender=1 and isdelete=0</span><br><span class="line">order by id desc;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询未删除科目信息，按名称升序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from subject</span><br><span class="line">where isdelete=0</span><br><span class="line">order by stitle;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-5-分页"><a href="#2-5-分页" class="headerlink" title="2.5-分页"></a>2.5-分页</h3><ul>
<li><p>获取部分行</p>
<ul>
<li><p>当数据量过大时，在一页中查看数据是一件非常麻烦的事情</p>
</li>
<li><p>语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名</span><br><span class="line">limit start,count</span><br></pre></td></tr></table></figure>
<ul>
<li>从start开始，获取count条数据</li>
<li>start索引从0开始</li>
</ul>
</li>
</ul>
</li>
<li><p>示例：分页</p>
<ul>
<li><p>已知：每页显示m条数据，当前显示第n页</p>
</li>
<li><p>求总页数：此段逻辑后面会在python中实现</p>
<ul>
<li>查询总条数p1</li>
<li>使用p1除以m得到p2</li>
<li>如果整除则p2为总数页</li>
<li>如果不整除则p2+1为总页数</li>
</ul>
</li>
<li><p>求第n页的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from students</span><br><span class="line">where isdelete=0</span><br><span class="line">limit (n-1)*m,m</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="2-6-总结"><a href="#2-6-总结" class="headerlink" title="2.6-总结"></a>2.6-总结</h3><ul>
<li><p>完整的select语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select distinct *</span><br><span class="line">from 表名</span><br><span class="line">where ....</span><br><span class="line">group by ... having ...</span><br><span class="line">order by ...</span><br><span class="line">limit star,count</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行顺序为：</p>
<ul>
<li>from 表名</li>
<li>where ….</li>
<li>group by …</li>
<li>select distinct *</li>
<li>having …</li>
<li>order by …</li>
<li>limit star,count</li>
</ul>
</li>
<li><p>实际使用中，只是语句中某些部分的组合，而不是全部</p>
</li>
</ul>
<h2 id="03-高级操作"><a href="#03-高级操作" class="headerlink" title="03-高级操作"></a>03-高级操作</h2><ul>
<li>实体与实体之间有3种对应关系，这些关系也需要存储下来</li>
<li>在开发中需要对存储的数据进行一些处理，用到内置的一些函数</li>
<li>视图用于完成查询语句的封装</li>
<li>事务可以保证复杂的增删改操作有效</li>
</ul>
<h3 id="3-1-关系"><a href="#3-1-关系" class="headerlink" title="3.1-关系"></a>3.1-关系</h3><ul>
<li><p>关系</p>
<ul>
<li><p>创建成绩表scores，结构如下</p>
<ul>
<li>id</li>
<li>学生</li>
<li>科目</li>
<li>成绩</li>
</ul>
</li>
<li><p>思考：学生列应该存什么信息呢？ 答：学生列的数据不是在这里新建的，而应该从学生表引用过来，关系也是一条数据；根据范式要求应该存储学生的编号，而不是学生的姓名等其它信息</p>
</li>
<li><p>同理，科目表也是关系列，引用科目表中的数据</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-5/15636253.jpg?ynotemdtimestamp=1550481878480" alt="img"></p>
</li>
<li><p>创建表的语句如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table scores(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">stuid int,</span><br><span class="line">subid int,</span><br><span class="line">score decimal(5,2)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>外键</p>
<ul>
<li><p>思考：怎么保证关系列数据的有效性呢？任何整数都可以吗？ 答：必须是学生表中id列存在的数据，可以通过外键约束进行数据的有效性验证</p>
</li>
<li><p>为stuid添加外键约束 <code>alter table scores add constraint stu_sco foreign key(stuid) references students(id);</code></p>
</li>
<li><p>此时插入或者修改数据时，如果stuid的值在students表中不存在则会报错</p>
</li>
<li><p>在创建表时可以直接创建约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table scores(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">stuid int,</span><br><span class="line">subid int,</span><br><span class="line">score decimal(5,2),</span><br><span class="line">foreign key(stuid) references students(id),</span><br><span class="line">foreign key(subid) references subjects(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>外键的级联操作</p>
<ul>
<li>在删除students表的数据时，如果这个id值在scores中已经存在，则会抛异常</li>
<li>推荐使用逻辑删除，还可以解决这个问题</li>
<li>可以创建表时指定级联操作，也可以在创建表后再修改外键的级联操作</li>
<li>语法 <code>alter table scores add constraint stu_sco foreign key(stuid) references students(id) on delete cascade;</code></li>
<li>级联操作的类型包括：<ul>
<li>restrict（限制）：默认值，抛异常</li>
<li>cascade（级联）：如果主表的记录删掉，则从表中相关联的记录都将被删除</li>
<li>set null：将外键设置为空</li>
<li>no action：什么都不做</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-2-连接"><a href="#3-2-连接" class="headerlink" title="3.2-连接"></a>3.2-连接</h3><ul>
<li><p>看个问题</p>
<ul>
<li><p>问：查询每个学生每个科目的分数 分析：学生姓名来源于students表，科目名称来源于subjects，分数来源于scores表，怎么将3个表放到一起查询，并将结果显示在同一个结果集中呢？ 答：当查询结果来源于多张表时，需要使用连接查询</p>
</li>
<li><p>关键：找到表间的关系，当前的关系是</p>
<ul>
<li>students表的id—scores表的stuid</li>
<li>subjects表的id—scores表的subid</li>
</ul>
</li>
<li><p>则上面问题的答案是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select students.sname,subjects.stitle,scores.score</span><br><span class="line">from scores</span><br><span class="line">inner join students on scores.stuid=students.id</span><br><span class="line">inner join subjects on scores.subid=subjects.id;</span><br></pre></td></tr></table></figure>
</li>
<li><p>结论：当需要对有关系的多张表进行查询时，需要使用连接join</p>
</li>
</ul>
</li>
<li><p>连接查询</p>
<ul>
<li>连接查询分类如下：<ul>
<li>表A inner join 表B：表A与表B匹配的行会出现在结果中</li>
<li>表A left join 表B：表A与表B匹配的行会出现在结果中，外加表A中独有的数据，未对应的数据使用null填充</li>
<li>表A right join 表B：表A与表B匹配的行会出现在结果中，外加表B中独有的数据，未对应的数据使用null填充</li>
</ul>
</li>
<li>在查询或条件中推荐使用“表名.列名”的语法</li>
<li>如果多个表中列名不重复可以省略“表名.”部分</li>
<li>如果表的名称太长，可以在表名后面使用’ as 简写名’或’ 简写名’，为表起个临时的简写名称</li>
</ul>
</li>
<li><p>练习</p>
<ul>
<li><p>查询学生的姓名、平均分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select students.sname,avg(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join students on scores.stuid=students.id</span><br><span class="line">group by students.sname;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询男生的姓名、总分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select students.sname,avg(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join students on scores.stuid=students.id</span><br><span class="line">where students.gender=1</span><br><span class="line">group by students.sname;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询科目的名称、平均分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select subjects.stitle,avg(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join subjects on scores.subid=subjects.id</span><br><span class="line">group by subjects.stitle;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询未删除科目的名称、最高分、平均分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select subjects.stitle,avg(scores.score),max(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join subjects on scores.subid=subjects.id</span><br><span class="line">where subjects.isdelete=0</span><br><span class="line">group by subjects.stitle;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="3-3-自关联"><a href="#3-3-自关联" class="headerlink" title="3.3-自关联"></a>3.3-自关联</h3><ul>
<li><p>设计省信息的表结构provinces</p>
<ul>
<li>id</li>
<li>ptitle</li>
</ul>
</li>
<li><p>设计市信息的表结构citys</p>
<ul>
<li>id</li>
<li>ctitle</li>
<li>proid</li>
</ul>
</li>
<li><p>citys表的proid表示城市所属的省，对应着provinces表的id值</p>
</li>
<li><p>问题：能不能将两个表合成一张表呢？</p>
<p>思考：观察两张表发现，citys表比provinces表多一个列proid，其它列的类型都是一样的</p>
<p>意义：存储的都是地区信息，而且每种信息的数据量有限，没必要增加一个新表，或者将来还要存储区、乡镇信息，都增加新表的开销太大</p>
<p>答案：定义表areas，结构如下</p>
<ul>
<li>id</li>
<li>atitle</li>
<li>pid</li>
</ul>
</li>
<li><p>因为省没有所属的省份，所以可以填写为null</p>
</li>
<li><p>城市所属的省份pid，填写省所对应的编号id</p>
</li>
<li><p>这就是自关联，表中的某一列，关联了这个表中的另外一列，但是它们的业务逻辑含义是不一样的，城市信息的pid引用的是省信息的id</p>
</li>
<li><p>在这个表中，结构不变，可以添加区县、乡镇街道、村社区等信息</p>
</li>
<li><p>创建areas表的语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table areas(</span><br><span class="line">id int primary key,</span><br><span class="line">atitle varchar(20),</span><br><span class="line">pid int,</span><br><span class="line">foreign key(pid) references areas(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>从sql文件中导入数据 <code>1source areas.sql;</code></p>
</li>
<li><p>查询一共有多少个省 查询省的名称为“山西省”的所有城市</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select city.* from areas as city</span><br><span class="line">inner join areas as province on city.pid=province.id</span><br><span class="line">where province.atitle=&apos;山西省&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询市的名称为“广州市”的所有区县</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select dis.*,dis2.* from areas as dis</span><br><span class="line">inner join areas as city on city.id=dis.pid</span><br><span class="line">left join areas as dis2 on dis.id=dis2.pid</span><br><span class="line">where city.atitle=&apos;广州市&apos;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-4-子查询"><a href="#3-4-子查询" class="headerlink" title="3.4-子查询"></a>3.4-子查询</h3><ul>
<li><p>查询支持嵌套使用</p>
</li>
<li><p>查询各学生的语文、数学、英语的成绩</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select sname,</span><br><span class="line">(select sco.score from scores sco inner join subjects sub on sco.subid=sub.id where sub.stitle=&apos;语文&apos; and stuid=stu.id) as 语文,</span><br><span class="line">(select sco.score from  scores sco inner join subjects sub on sco.subid=sub.id where sub.stitle=&apos;数学&apos; and stuid=stu.id) as 数学,</span><br><span class="line">(select sco.score from  scores sco inner join subjects sub on sco.subid=sub.id where sub.stitle=&apos;英语&apos; and stuid=stu.id) as 英语</span><br><span class="line">from students stu;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-5-内置函数"><a href="#3-5-内置函数" class="headerlink" title="3.5-内置函数"></a>3.5-内置函数</h3><ul>
<li><p>字符串函数</p>
<ul>
<li><p>查看字符的ascii码值ascii(str)，str是空串时返回0 <code>select ascii(&#39;a&#39;);</code></p>
</li>
<li><p>查看ascii码值对应的字符char(数字) <code>select char(97);</code></p>
</li>
<li><p>拼接字符串concat(str1,str2…) <code>select concat(12,34,&#39;ab&#39;);</code></p>
</li>
<li><p>包含字符个数length(str) <code>select length(&#39;abc&#39;);</code></p>
</li>
<li><p>截取字符串</p>
<ul>
<li><p>left(str,len)返回字符串str的左端len个字符</p>
</li>
<li><p>right(str,len)返回字符串str的右端len个字符</p>
</li>
<li><p>substring(str,pos,len)返回字符串str的位置pos起len个字符</p>
<p><code>select substring(&#39;abc123&#39;,2,3);</code></p>
</li>
<li></li>
</ul>
</li>
<li><p>去除空格</p>
<ul>
<li><p>ltrim(str)返回删除了左空格的字符串str</p>
</li>
<li><p>rtrim(str)返回删除了右空格的字符串str</p>
</li>
<li><p>trim([方向 remstr from str)返回从某侧删除remstr后的字符串str，方向词包括both、leading、trailing，表示两侧、左、右</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select trim(&apos;  bar   &apos;);</span><br><span class="line">select trim(leading &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br><span class="line">select trim(both &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br><span class="line">select trim(trailing &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>返回由n个空格字符组成的一个字符串space(n) <code>select space(10);</code></p>
</li>
<li><p>替换字符串replace(str,from_str,to_str) <code>select replace(&#39;abc123&#39;,&#39;123&#39;,&#39;def&#39;);</code></p>
</li>
<li><p>大小写转换，函数如下</p>
<ul>
<li>lower(str)</li>
<li>upper(str)</li>
</ul>
<p><code>select lower(&#39;aBcD&#39;);</code></p>
</li>
</ul>
</li>
<li><p>数学函数</p>
<ul>
<li>求绝对值abs(n) <code>select abs(-32);</code></li>
<li>求m除以n的余数mod(m,n)，同运算符% <code>select mod(10,3);`</code>select 10%3;`</li>
<li>地板floor(n)，表示不大于n的最大整数 <code>select floor(2.3);</code></li>
<li>天花板ceiling(n)，表示不小于n的最大整数 <code>select ceiling(2.3);</code></li>
<li>求四舍五入值round(n,d)，n表示原数，d表示小数位置，默认为0 <code>select round(1.6);</code></li>
<li>求x的y次幂pow(x,y) <code>select pow(2,3);</code></li>
<li>获取圆周率PI() <code>select PI();</code></li>
<li>随机数rand()，值为0-1.0的浮点数 <code>select rand();</code></li>
</ul>
</li>
<li><p>日期时间函数</p>
<ul>
<li><p>获取子值，语法如下</p>
<ul>
<li><p>year(date)返回date的年份(范围在1000到9999)</p>
</li>
<li><p>month(date)返回date中的月份数值</p>
</li>
<li><p>day(date)返回date中的日期数值</p>
</li>
<li><p>hour(time)返回time的小时数(范围是0到23)</p>
</li>
<li><p>minute(time)返回time的分钟数(范围是0到59)</p>
</li>
<li><p>second(time)返回time的秒数(范围是0到59)</p>
<p><code>select year(&#39;2016-12-21&#39;);</code></p>
</li>
</ul>
</li>
<li><p>日期计算，使用+-运算符，数字后面的关键字为year、month、day、hour、minute、second <code>select &#39;2016-12-21&#39;+interval 1 day;</code></p>
</li>
<li><p>日期格式化date_format(date,format)，format参数可用的值如下</p>
<ul>
<li><p>获取年%Y，返回4位的整数</p>
<p>*　获取年%y，返回2位的整数</p>
<p>*　获取月%m，值为1-12的整数</p>
</li>
<li><p>获取日%d，返回整数</p>
<p>*　获取时%H，值为0-23的整数</p>
<p>*　获取时%h，值为1-12的整数</p>
<p>*　获取分%i，值为0-59的整数</p>
<p>*　获取秒%s，值为0-59的整数</p>
</li>
</ul>
<p><code>select date_format(&#39;2016-12-21&#39;,&#39;%Y %m %d&#39;);</code></p>
</li>
<li><p>当前日期current_date() <code>select current_date();</code></p>
</li>
<li><p>当前时间current_time() <code>select current_time();</code></p>
</li>
<li><p>当前日期时间now() <code>select now();</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="3-6-视图"><a href="#3-6-视图" class="headerlink" title="3.6-视图"></a>3.6-视图</h3><ul>
<li><p>对于复杂的查询，在多次使用后，维护是一件非常麻烦的事情</p>
</li>
<li><p>解决：定义视图</p>
</li>
<li><p>视图本质就是对查询的一个封装</p>
</li>
<li><p>定义视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create view stuscore as </span><br><span class="line">select students.*,scores.score from scores</span><br><span class="line">inner join students on scores.stuid=students.id;</span><br></pre></td></tr></table></figure>
</li>
<li><p>视图的用途就是查询 <code>select * from stuscore;</code></p>
</li>
</ul>
<h3 id="3-7-事务"><a href="#3-7-事务" class="headerlink" title="3.7-事务"></a>3.7-事务</h3><ul>
<li><p>事务</p>
<ul>
<li><p>使用事务可以完成退回的功能，保证业务逻辑的正确性</p>
</li>
<li><p>事务四大特性(简称ACID)</p>
<ul>
<li>原子性(Atomicity)：事务中的全部操作在数据库中是不可分割的，要么全部完成，要么均不执行</li>
<li>一致性(Consistency)：几个并行执行的事务，其执行结果必须与按某一顺序串行执行的结果相一致</li>
<li>隔离性(Isolation)：事务的执行不受其他事务的干扰，事务执行的中间结果对其他事务必须是透明的</li>
<li>持久性(Durability)：对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障</li>
</ul>
</li>
<li><p>要求：表的类型必须是innodb或bdb类型，才可以对此表使用事务</p>
</li>
<li><p>查看表的创建语句</p>
<p><code>show create table students;</code></p>
</li>
<li><p>修改表的类型 <code>alter table &#39;表名&#39; engine=innodb;</code></p>
</li>
<li><p>事务语句 <code>开启begin;`</code>提交commit;<code></code>回滚rollback;`</p>
</li>
</ul>
</li>
<li><p>示例1</p>
<ul>
<li><p>步骤1：打开两个终端，连接mysql，使用同一个数据库，操作同一张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">终端1：</span><br><span class="line">select * from students;</span><br><span class="line">------------------------</span><br><span class="line">终端2：</span><br><span class="line">begin;</span><br><span class="line">insert into students(sname) values(&apos;张飞&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>步骤2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">终端1：</span><br><span class="line">select * from students;</span><br></pre></td></tr></table></figure>
</li>
<li><p>步骤3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">终端2：</span><br><span class="line">commit;</span><br><span class="line">------------------------</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>示例2</p>
<ul>
<li><p>步骤1：打开两个终端，连接mysql，使用同一个数据库，操作同一张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">终端1：</span><br><span class="line">select * from students;</span><br><span class="line">------------------------</span><br><span class="line">终端2：</span><br><span class="line">begin;</span><br><span class="line">insert into students(sname) values(&apos;张飞&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>步骤2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">终端1：</span><br><span class="line">select * from students;</span><br></pre></td></tr></table></figure>
</li>
<li><p>步骤3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">终端2：</span><br><span class="line">rollback;</span><br><span class="line">------------------------</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="3-8-总结"><a href="#3-8-总结" class="headerlink" title="3.8-总结"></a>3.8-总结</h3><ul>
<li>关系的存储</li>
<li>连接查询</li>
<li>自关联</li>
<li>子查询</li>
<li>常用内置函数</li>
<li>视图</li>
<li>事务</li>
</ul>
<h2 id="04-与Python交互"><a href="#04-与Python交互" class="headerlink" title="04-与Python交互"></a>04-与Python交互</h2><ul>
<li>在熟练使用sql语句的基础上，开始使用python语言提供的模块与mysql进行交互</li>
<li>这是我们在工作中大事要做的事</li>
<li>先学会sql是基础，一定要熟练编写sql语句</li>
</ul>
<h3 id="4-1-交互类型"><a href="#4-1-交互类型" class="headerlink" title="4.1-交互类型"></a>4.1-交互类型</h3><ul>
<li><p>安装引入模块</p>
<ul>
<li>安装mysql模块 <code>sudo apt-get install python-mysql</code></li>
<li>在文件中引入模块 <code>import Mysqldb</code></li>
</ul>
</li>
<li><p>Connection对象</p>
<ul>
<li><p>用于建立与数据库的连接</p>
</li>
<li><p>创建对象：调用connect()方法</p>
<p><code>conn=connect(参数列表)</code></p>
</li>
<li><p>参数host：连接的mysql主机，如果本机是’localhost’</p>
</li>
<li><p>参数port：连接的mysql主机的端口，默认是3306</p>
</li>
<li><p>参数db：数据库的名称</p>
</li>
<li><p>参数user：连接的用户名</p>
</li>
<li><p>参数password：连接的密码</p>
</li>
<li><p>参数charset：通信采用的编码方式，默认是’gb2312’，要求与数据库创建时指定的编码一致，否则中文会乱码</p>
</li>
</ul>
</li>
<li><p>对象的方法</p>
<ul>
<li>close()关闭连接</li>
<li>commit()事务，所以需要提交才会生效</li>
<li>rollback()事务，放弃之前的操作</li>
<li>cursor()返回Cursor对象，用于执行sql语句并获得结果</li>
</ul>
</li>
<li><p>Cursor对象</p>
<ul>
<li><p>执行sql语句</p>
</li>
<li><p>创建对象：调用Connection对象的cursor()方法</p>
<p><code>cursor1=conn.cursor()</code></p>
</li>
</ul>
</li>
<li><p>对象的方法</p>
<ul>
<li>close()关闭</li>
<li>execute(operation [, parameters ])执行语句，返回受影响的行数</li>
<li>fetchone()执行查询语句时，获取查询结果集的第一个行数据，返回一个元组</li>
<li>next()执行查询语句时，获取当前行的下一行</li>
<li>fetchall()执行查询时，获取结果集的所有行，一行构成一个元组，再将这些元组装入一个元组返回</li>
<li>scroll(value[,mode])将行指针移动到某个位置<ul>
<li>mode表示移动的方式</li>
<li>mode的默认值为relative，表示基于当前行移动到value，value为正则向下移动，value为负则向上移动</li>
<li>mode的值为absolute，表示基于第一条数据的位置，第一条数据的位置为0</li>
</ul>
</li>
</ul>
</li>
<li><p>对象的属性</p>
<ul>
<li>rowcount只读属性，表示最近一次execute()执行后受影响的行数</li>
<li>connection获得当前连接对象</li>
</ul>
</li>
</ul>
<h3 id="4-2-增改删"><a href="#4-2-增改删" class="headerlink" title="4.2-增改删"></a>4.2-增改删</h3><ul>
<li><p>增加</p>
<p>创建testInsert.py文件，向学生表中插入一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    count=cs1.execute(&quot;insert into students(sname) values(&apos;张良&apos;)&quot;)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改</p>
<p>创建testUpdate.py文件，修改学生表的一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    count=cs1.execute(&quot;update students set sname=&apos;刘邦&apos; where id=6&quot;)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<p>创建testDelete.py文件，删除学生表的一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    count=cs1.execute(&quot;delete from students where id=6&quot;)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure>
</li>
<li><p>sql语句参数化</p>
<p>创建testInsertParam.py文件，向学生表中插入一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    sname=raw_input(&quot;请输入学生姓名：&quot;)</span><br><span class="line">    params=[sname]</span><br><span class="line">    count=cs1.execute(&apos;insert into students(sname) values(%s)&apos;,params)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它语句</p>
<ul>
<li>cursor对象的execute()方法，也可以用于执行create table等语句</li>
<li>建议在开发之初，就创建好数据库表结构，不要在这里执行</li>
</ul>
</li>
</ul>
<h3 id="4-3-查询"><a href="#4-3-查询" class="headerlink" title="4.3-查询"></a>4.3-查询</h3><ul>
<li><p>查询一行数据</p>
<p>创建testSelectOne.py文件，查询一条学生信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cur=conn.cursor()</span><br><span class="line">    cur.execute(&apos;select * from students where id=7&apos;)</span><br><span class="line">    result=cur.fetchone()</span><br><span class="line">    print result</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询多行数据</p>
<p>创建testSelectMany.py文件，查询一条学生信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cur=conn.cursor()</span><br><span class="line">    cur.execute(&apos;select * from students&apos;)</span><br><span class="line">    result=cur.fetchall()</span><br><span class="line">    print result</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-4-封装"><a href="#4-4-封装" class="headerlink" title="4.4-封装"></a>4.4-封装</h3><ul>
<li><p>观察前面的文件发现，除了sql语句及参数不同，其它语句都是一样的</p>
</li>
<li><p>创建MysqlHelper.py文件，定义类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf8</span><br><span class="line">import MySQLdb</span><br><span class="line"></span><br><span class="line">class MysqlHelper():</span><br><span class="line">    def __init__(self,host,port,db,user,passwd,charset=&apos;utf8&apos;):</span><br><span class="line">        self.host=host</span><br><span class="line">        self.port=port</span><br><span class="line">        self.db=db</span><br><span class="line">        self.user=user</span><br><span class="line">        self.passwd=passwd</span><br><span class="line">        self.charset=charset</span><br><span class="line"></span><br><span class="line">    def connect(self):</span><br><span class="line">        self.conn=MySQLdb.connect(host=self.host,port=self.port,db=self.db,user=self.user,passwd=self.passwd,charset=self.charset)</span><br><span class="line">        self.cursor=self.conn.cursor()</span><br><span class="line"></span><br><span class="line">    def close(self):</span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line"></span><br><span class="line">    def get_one(self,sql,params=()):</span><br><span class="line">        result=None</span><br><span class="line">        try:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql, params)</span><br><span class="line">            result = self.cursor.fetchone()</span><br><span class="line">            self.close()</span><br><span class="line">        except Exception, e:</span><br><span class="line">            print e.message</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">    def get_all(self,sql,params=()):</span><br><span class="line">        list=()</span><br><span class="line">        try:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql,params)</span><br><span class="line">            list=self.cursor.fetchall()</span><br><span class="line">            self.close()</span><br><span class="line">        except Exception,e:</span><br><span class="line">            print e.message</span><br><span class="line">        return list</span><br><span class="line"></span><br><span class="line">    def insert(self,sql,params=()):</span><br><span class="line">        return self.__edit(sql,params)</span><br><span class="line"></span><br><span class="line">    def update(self, sql, params=()):</span><br><span class="line">        return self.__edit(sql, params)</span><br><span class="line"></span><br><span class="line">    def delete(self, sql, params=()):</span><br><span class="line">        return self.__edit(sql, params)</span><br><span class="line"></span><br><span class="line">    def __edit(self,sql,params):</span><br><span class="line">        count=0</span><br><span class="line">        try:</span><br><span class="line">            self.connect()</span><br><span class="line">            count=self.cursor.execute(sql,params)</span><br><span class="line">            self.conn.commit()</span><br><span class="line">            self.close()</span><br><span class="line">        except Exception,e:</span><br><span class="line">            print e.message</span><br><span class="line">        return count</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加</p>
<p>创建testInsertWrap.py文件，使用封装好的帮助类完成插入操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf8</span><br><span class="line">from MysqlHelper import *</span><br><span class="line"></span><br><span class="line">sql=&apos;insert into students(sname,gender) values(%s,%s)&apos;</span><br><span class="line">sname=raw_input(&quot;请输入用户名：&quot;)</span><br><span class="line">gender=raw_input(&quot;请输入性别，1为男，0为女&quot;)</span><br><span class="line">params=[sname,bool(gender)]</span><br><span class="line"></span><br><span class="line">mysqlHelper=MysqlHelper(&apos;localhost&apos;,3306,&apos;test1&apos;,&apos;root&apos;,&apos;mysql&apos;)</span><br><span class="line">count=mysqlHelper.insert(sql,params)</span><br><span class="line">if count==1:</span><br><span class="line">    print &apos;ok&apos;</span><br><span class="line">else:</span><br><span class="line">    print &apos;error&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询一个</p>
<p>创建testGetOneWrap.py文件，使用封装好的帮助类完成查询最新一行数据操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf8</span><br><span class="line">from MysqlHelper import *</span><br><span class="line"></span><br><span class="line">sql=&apos;select sname,gender from students order by id desc&apos;</span><br><span class="line"></span><br><span class="line">helper=MysqlHelper(&apos;localhost&apos;,3306,&apos;test1&apos;,&apos;root&apos;,&apos;mysql&apos;)</span><br><span class="line">one=helper.get_one(sql)</span><br><span class="line">print one</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-5-用户登录"><a href="#4-5-用户登录" class="headerlink" title="4.5-用户登录"></a>4.5-用户登录</h3><ul>
<li><p>创建用户表userinfos</p>
<ul>
<li><p>表结构如下</p>
<ul>
<li>id</li>
<li>uname</li>
<li>upwd</li>
<li>isdelete</li>
</ul>
</li>
<li><p>注意：需要对密码进行加密</p>
</li>
<li><p>如果使用md5加密，则密码包含32个字符</p>
</li>
<li><p>如果使用sha1加密，则密码包含40个字符，推荐使用这种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table userinfos(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">uname varchar(20),</span><br><span class="line">upwd char(40),</span><br><span class="line">isdelete bit default 0</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>加入测试数据</p>
<p>插入如下数据，用户名为123,密码为123,这是sha1加密后的值</p>
<p><code>insert into userinfos values(0,&#39;123&#39;,&#39;40bd001563085fc35165329ea1ff5c5ecbdbbeef&#39;,0);</code></p>
</li>
<li><p>接收输入并验证</p>
<ul>
<li><p>创建testLogin.py文件，引入hashlib模块、MysqlHelper模块</p>
</li>
<li><p>接收输入</p>
</li>
<li><p>根据用户名查询，如果未查到则提示用户名不存在</p>
</li>
<li><p>如果查到则匹配密码是否相等，如果相等则提示登录成功</p>
</li>
<li><p>如果不相等则提示密码错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">from MysqlHelper import MysqlHelper</span><br><span class="line">from hashlib import sha1</span><br><span class="line"></span><br><span class="line">sname=raw_input(&quot;请输入用户名：&quot;)</span><br><span class="line">spwd=raw_input(&quot;请输入密码:&quot;)</span><br><span class="line"></span><br><span class="line">s1=sha1()</span><br><span class="line">s1.update(spwd)</span><br><span class="line">spwdSha1=s1.hexdigest()</span><br><span class="line"></span><br><span class="line">sql=&quot;select upwd from userinfos where uname=%s&quot;</span><br><span class="line">params=[sname]</span><br><span class="line"></span><br><span class="line">sqlhelper=MysqlHelper(&apos;localhost&apos;,3306,&apos;test1&apos;,&apos;root&apos;,&apos;mysql&apos;)</span><br><span class="line">userinfo=sqlhelper.get_one(sql,params)</span><br><span class="line">if userinfo==None:</span><br><span class="line">    print &apos;用户名错误&apos;</span><br><span class="line">elif userinfo[0]==spwdSha1:</span><br><span class="line">    print &apos;登录成功&apos;</span><br><span class="line">else:</span><br><span class="line">    print &apos;密码错误&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="4-6-总结"><a href="#4-6-总结" class="headerlink" title="4.6-总结"></a>4.6-总结</h3><ul>
<li>python操作数据库的类型及主要成员</li>
<li>使用python类完成crud操作</li>
<li>封装操作数据库的工具类</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"># python</a>
          
            <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/19/python-Redis/" rel="next" title="python-Redis">
                <i class="fa fa-chevron-left"></i> python-Redis
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/19/python-MongoDB/" rel="prev" title="python-MongoDB">
                python-MongoDB <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ry1ynn">
            
              <p class="site-author-name" itemprop="name">Ry1ynn</p>
              <p class="site-description motion-element" itemprop="description">我们的征途是星辰大海</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">127</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ry1ynn" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ry1ynn_pri@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="/images/weixin.JPG" target="_blank" title="Wechat">
                      
                        <i class="fa fa-fw fa-weixin"></i>Wechat</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.t00ls.net/" title="T00ls" target="_blank">T00ls</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.freebuf.com/" title="FreeBuf" target="_blank">FreeBuf</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.sec-wiki.com/" title="SecWiki" target="_blank">SecWiki</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.seebug.org/" title="Seebug" target="_blank">Seebug</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.91ri.org/" title="91Ri" target="_blank">91Ri</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.pediy.com/" title="看雪" target="_blank">看雪</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.52pojie.cn/" title="吾爱破解" target="_blank">吾爱破解</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.anquanke.com/" title="安全客" target="_blank">安全客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.ichunqiu.com/" title="i春秋" target="_blank">i春秋</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL相关"><span class="nav-text">MySQL相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#00-简介"><span class="nav-text">00-简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#01-创建库和表"><span class="nav-text">01-创建库和表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-数据库简介"><span class="nav-text">1.1-数据库简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-安装管理"><span class="nav-text">1.2-安装管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-数据完整性"><span class="nav-text">1.3-数据完整性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-图形窗口操作"><span class="nav-text">1.4-图形窗口操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-命令脚本操作"><span class="nav-text">1.5-命令脚本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-总结"><span class="nav-text">1.6-总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#02-查询"><span class="nav-text">02-查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-条件"><span class="nav-text">2.1-条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-聚合"><span class="nav-text">2.2-聚合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-分组"><span class="nav-text">2.3-分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-排序"><span class="nav-text">2.4-排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-分页"><span class="nav-text">2.5-分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-总结"><span class="nav-text">2.6-总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#03-高级操作"><span class="nav-text">03-高级操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-关系"><span class="nav-text">3.1-关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-连接"><span class="nav-text">3.2-连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-自关联"><span class="nav-text">3.3-自关联</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-子查询"><span class="nav-text">3.4-子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-内置函数"><span class="nav-text">3.5-内置函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-视图"><span class="nav-text">3.6-视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-事务"><span class="nav-text">3.7-事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-总结"><span class="nav-text">3.8-总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#04-与Python交互"><span class="nav-text">04-与Python交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-交互类型"><span class="nav-text">4.1-交互类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-增改删"><span class="nav-text">4.2-增改删</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-查询"><span class="nav-text">4.3-查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-封装"><span class="nav-text">4.4-封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-用户登录"><span class="nav-text">4.5-用户登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-总结"><span class="nav-text">4.6-总结</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ry1ynn</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  










  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script id="ribbon" type="text/javascript" size="300" alpha="0.5" zindex="0" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
