<!DOCTYPE html>



  



<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">






  <meta name="keywords" content="python,爬虫,图像识别,">










<meta name="description" content="动态HTML处理&amp;amp;机器图像识别03-案例1：网站模拟登录 code">
<meta name="keywords" content="python,爬虫,图像识别">
<meta property="og:type" content="article">
<meta property="og:title" content="动态HTML处理&amp;机器图像识别-2">
<meta property="og:url" content="http://21guns.top/2018/01/04/动态HTML处理-机器图像识别-2/index.html">
<meta property="og:site_name" content="Ry1ynn&#39;s blogs">
<meta property="og:description" content="动态HTML处理&amp;amp;机器图像识别03-案例1：网站模拟登录 code">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-4/33034357.jpg?ynotemdtimestamp=1550480900687">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-4/39994570.jpg?ynotemdtimestamp=1550480900687">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-4/36341178.jpg?ynotemdtimestamp=1550480900687">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-4/14228744.jpg?ynotemdtimestamp=1550480900687">
<meta property="og:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-4/32143587.jpg?ynotemdtimestamp=1550480900687">
<meta property="og:updated_time" content="2019-02-18T09:14:17.623Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="动态HTML处理&amp;机器图像识别-2">
<meta name="twitter:description" content="动态HTML处理&amp;amp;机器图像识别03-案例1：网站模拟登录 code">
<meta name="twitter:image" content="http://ot12pfxkm.bkt.clouddn.com/18-1-4/33034357.jpg?ynotemdtimestamp=1550480900687">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://21guns.top/2018/01/04/动态HTML处理-机器图像识别-2/">





  <title>动态HTML处理&机器图像识别-2 | Ry1ynn's blogs</title>
  










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ry1ynn's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://21guns.top/2018/01/04/动态HTML处理-机器图像识别-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ry1ynn">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ry1ynn's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">动态HTML处理&机器图像识别-2</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-04T17:06:11+08:00">
                2018-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">爬虫</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="动态HTML处理-amp-机器图像识别"><a href="#动态HTML处理-amp-机器图像识别" class="headerlink" title="动态HTML处理&amp;机器图像识别"></a>动态HTML处理&amp;机器图像识别</h1><h2 id="03-案例1：网站模拟登录"><a href="#03-案例1：网站模拟登录" class="headerlink" title="03-案例1：网站模拟登录"></a>03-案例1：网站模拟登录</h2><ul>
<li><p>code<a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># douban.py</span><br><span class="line"></span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">driver = webdriver.PhantomJS()</span><br><span class="line">driver.get(&quot;http://www.douban.com&quot;)</span><br><span class="line"></span><br><span class="line"># 输入账号密码</span><br><span class="line">driver.find_element_by_name(&quot;form_email&quot;).send_keys(&quot;xxxxx@xxxx.com&quot;)</span><br><span class="line">driver.find_element_by_name(&quot;form_password&quot;).send_keys(&quot;xxxxxxxx&quot;)</span><br><span class="line"></span><br><span class="line"># 模拟点击登录</span><br><span class="line">driver.find_element_by_xpath(&quot;//input[@class=&apos;bn-submit&apos;]&quot;).click()</span><br><span class="line"></span><br><span class="line"># 等待3秒</span><br><span class="line">time.sleep(3)</span><br><span class="line"></span><br><span class="line"># 生成登陆后快照</span><br><span class="line">driver.save_screenshot(&quot;douban.png&quot;)</span><br><span class="line"></span><br><span class="line">with open(&quot;douban.html&quot;, &quot;w&quot;) as file:</span><br><span class="line">    file.write(driver.page_source)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="04-案例2：动态页面模拟点击"><a href="#04-案例2：动态页面模拟点击" class="headerlink" title="04-案例2：动态页面模拟点击"></a>04-案例2：动态页面模拟点击</h2><ul>
<li><p>code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line"># python的测试模块</span><br><span class="line">import unittest</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class douyuSelenium(unittest.TestCase):</span><br><span class="line">    # 初始化方法</span><br><span class="line">    def setUp(self):</span><br><span class="line">        self.driver = webdriver.PhantomJS()</span><br><span class="line"></span><br><span class="line">    #具体的测试用例方法，一定要以test开头</span><br><span class="line">    def testDouyu(self):</span><br><span class="line">        self.driver.get(&apos;http://www.douyu.com/directory/all&apos;)</span><br><span class="line">        while True:</span><br><span class="line">            # 指定xml解析</span><br><span class="line">            soup = BeautifulSoup(driver.page_source, &apos;xml&apos;)</span><br><span class="line">            # 返回当前页面所有房间标题列表 和 观众人数列表</span><br><span class="line">            titles = soup.find_all(&apos;h3&apos;, &#123;&apos;class&apos;: &apos;ellipsis&apos;&#125;)</span><br><span class="line">            nums = soup.find_all(&apos;span&apos;, &#123;&apos;class&apos;: &apos;dy-num fr&apos;&#125;)</span><br><span class="line"></span><br><span class="line">            # 使用zip()函数来可以把列表合并，并创建一个元组对的列表[(1,2), (3,4)]</span><br><span class="line">            for title, num in zip(nums, titles):</span><br><span class="line">                print u&quot;观众人数:&quot; + num.get_text().strip(), u&quot;\t房间标题: &quot; + title.get_text().strip()</span><br><span class="line">            # page_source.find()未找到内容则返回-1</span><br><span class="line">            if driver.page_source.find(&apos;shark-pager-disable-next&apos;) != -1:</span><br><span class="line">                break</span><br><span class="line">            # 模拟下一页点击</span><br><span class="line">            self.driver.find_element_by_class_name(&apos;shark-pager-next&apos;).click()</span><br><span class="line"></span><br><span class="line">    # 退出时的清理方法</span><br><span class="line">    def tearDown(self):</span><br><span class="line">        print &apos;加载完成...&apos;</span><br><span class="line">        self.driver.quit()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="05-案例3：执行JavaScript语句"><a href="#05-案例3：执行JavaScript语句" class="headerlink" title="05-案例3：执行JavaScript语句"></a>05-案例3：执行JavaScript语句</h2><ul>
<li><p>隐藏百度图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.PhantomJS()</span><br><span class="line">driver.get(&quot;https://www.baidu.com/&quot;)</span><br><span class="line"></span><br><span class="line"># 给搜索输入框标红的javascript脚本</span><br><span class="line">js = &quot;var q=document.getElementById(\&quot;kw\&quot;);q.style.border=\&quot;2px solid red\&quot;;&quot;</span><br><span class="line"></span><br><span class="line"># 调用给搜索输入框标红js脚本</span><br><span class="line">driver.execute_script(js)</span><br><span class="line"></span><br><span class="line">#查看页面快照</span><br><span class="line">driver.save_screenshot(&quot;redbaidu.png&quot;)</span><br><span class="line"></span><br><span class="line">#js隐藏元素，将获取的图片元素隐藏</span><br><span class="line">img = driver.find_element_by_xpath(&quot;//*[@id=&apos;lg&apos;]/img&quot;)</span><br><span class="line">driver.execute_script(&apos;$(arguments[0]).fadeOut()&apos;,img)</span><br><span class="line"></span><br><span class="line"># 向下滚动到页面底部</span><br><span class="line">driver.execute_script(&quot;$(&apos;.scroll_top&apos;).click(function()&#123;$(&apos;html,body&apos;).animate(&#123;scrollTop: &apos;0px&apos;&#125;, 800);&#125;);&quot;)</span><br><span class="line"></span><br><span class="line">#查看页面快照</span><br><span class="line">driver.save_screenshot(&quot;nullbaidu.png&quot;)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
<li><p>模拟滚动条滚动到底部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># </span><br><span class="line">from selenium import webdriver</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">driver = webdriver.PhantomJS()</span><br><span class="line">driver.get(&quot;https://movie.douban.com/typerank?type_name=剧情&amp;type=11&amp;interval_id=100:90&amp;action=&quot;)</span><br><span class="line"></span><br><span class="line"># 向下滚动10000像素</span><br><span class="line">js = &quot;document.body.scrollTop=10000&quot;</span><br><span class="line">#js=&quot;var q=document.documentElement.scrollTop=10000&quot;</span><br><span class="line">time.sleep(3)</span><br><span class="line"></span><br><span class="line">#查看页面快照</span><br><span class="line">driver.save_screenshot(&quot;douban.png&quot;)</span><br><span class="line"></span><br><span class="line"># 执行JS语句</span><br><span class="line">driver.execute_script(js)</span><br><span class="line">time.sleep(10)</span><br><span class="line"></span><br><span class="line">#查看页面快照</span><br><span class="line">driver.save_screenshot(&quot;newdouban.png&quot;)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="06-机器视觉与Tesseract介绍"><a href="#06-机器视觉与Tesseract介绍" class="headerlink" title="06-机器视觉与Tesseract介绍"></a>06-机器视觉与Tesseract介绍</h2><h3 id="6-1-机器视觉"><a href="#6-1-机器视觉" class="headerlink" title="6.1-机器视觉"></a>6.1-机器视觉</h3><ul>
<li>从 Google 的无人驾驶汽车到可以识别假钞的自动售卖机，机器视觉一直都是一个应用广 泛且具有深远的影响和雄伟的愿景的领域。</li>
<li>我们将重点介绍机器视觉的一个分支：文字识别，介绍如何用一些 Python库来识别和使用在线图片中的文字。</li>
<li>我们可以很轻松的阅读图片里的文字，但是机器阅读这些图片就会非常困难，利用这种人类用户可以正常读取但是大多数机器人都没法读取的图片，验证码 (CAPTCHA)就出现了。验证码读取的难易程度也大不相同，有些验证码比其他的更加难读。</li>
<li>将图像翻译成文字一般被称为光学文字识别(Optical Character Recognition, OCR)。可以实现OCR的底层库并不多,目前很多库都是使用共同的几个底层 OCR 库,或者是在上面 进行定制。</li>
</ul>
<h3 id="6-2-ORC库概述"><a href="#6-2-ORC库概述" class="headerlink" title="6.2-ORC库概述"></a>6.2-ORC库概述</h3><ul>
<li>在读取和处理图像、图像相关的机器学习以及创建图像等任务中，Python 一直都是非常出色的语言。虽然有很多库可以进行图像处理，但在这里我们只重点介绍：<a href="https://pypi.python.org/pypi/pytesseract" target="_blank" rel="noopener">Tesseract</a></li>
<li>Tesseract 是一个 OCR 库,目前由 Google 赞助(Google 也是一家以 OCR 和机器学习技术闻名于世的公司)。Tesseract 是目前公认最优秀、最精确的开源 OCR 系统。 除了极高的精确度,Tesseract 也具有很高的灵活性。它可以通过训练识别出任何字体，也可以识别出任何 Unicode 字符。</li>
<li>安装Tesseract<ul>
<li>Windows 系统<ul>
<li>下载可执行安装文件<a href="https://code.google.com/p/tesseract-ocr/downloads/list安装。" target="_blank" rel="noopener">https://code.google.com/p/tesseract-ocr/downloads/list安装。</a></li>
</ul>
</li>
<li>Linux 系统<ul>
<li>可以通过 apt-get 安装: <code>$sudo apt-get tesseract-ocr</code></li>
</ul>
</li>
<li>Mac OS X系统<ul>
<li>用 Homebrew(<a href="http://brew.sh/" target="_blank" rel="noopener">http://brew.sh/</a>)等第三方库可以很方便地安装 brew install tesseract</li>
<li>要使用 Tesseract 的功能，比如后面的示例中训练程序识别字母，要先在系统中设置一 个新的环境变量 $TESSDATA_PREFIX，让 Tesseract 知道训练的数据文件存储在哪里，然后搞一份tessdata数据文件，放到Tesseract目录下。</li>
<li>在大多数 Linux 系统和 Mac OS X 系统上,你可以这么设置: <code>$export TESSDATA_PREFIX=/usr/local/share/Tesseract</code></li>
<li>在 Windows 系统上也类似,你可以通过下面这行命令设置环境变量: <code>#setx TESSDATA_PREFIX C:\Program Files\Tesseract OCR\Tesseract</code></li>
</ul>
</li>
</ul>
</li>
<li>安装pytesseract<ul>
<li>Tesseract 是一个 Python 的命令行工具，不是通过 import 语句导入的库。安装之后,要用 tesseract 命令在 Python 的外面运行，但我们可以通过 pip 安装支持Python 版本的 Tesseract库：</li>
<li>pip install pytesseract</li>
</ul>
</li>
</ul>
<h2 id="07-处理一些格式规范的文字"><a href="#07-处理一些格式规范的文字" class="headerlink" title="07-处理一些格式规范的文字"></a>07-处理一些格式规范的文字</h2><h3 id="7-1-处理给规范的文字"><a href="#7-1-处理给规范的文字" class="headerlink" title="7.1-处理给规范的文字"></a>7.1-处理给规范的文字</h3><ul>
<li>你要处理的大多数文字都是比较干净、格式规范的。格式规范的文字通常可以满足一些需求,不过究竟什么是“格式混乱”,什么算“格式规范”,确实因人而异。 通常,格式规范的文字具有以下特点:<ul>
<li>使用一个标准字体(不包含手写体、草书,或者十分“花哨的”字体) • 虽然被复印或拍照,字体还是很清晰,没有多余的痕迹或污点</li>
<li>排列整齐,没有歪歪斜斜的字</li>
<li>没有超出图片范围,也没有残缺不全,或紧紧贴在图片的边缘</li>
</ul>
</li>
<li>文字的一些格式问题在图片预处理时可以进行解决。例如,可以把图片转换成灰度图,调 整亮度和对比度,还可以根据需要进行裁剪和旋转（详情请关注图像与信号处理），但是,这些做法在进行更具扩展性的 训练时会遇到一些限制。</li>
</ul>
<h3 id="7-2-格式规范文字的理想示例"><a href="#7-2-格式规范文字的理想示例" class="headerlink" title="7.2-格式规范文字的理想示例"></a>7.2-格式规范文字的理想示例</h3><ul>
<li><p>格式规范文字的理想示例</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-4/33034357.jpg?ynotemdtimestamp=1550480900687" alt="img"></p>
<ul>
<li>通过下面的命令运行 Tesseract，读取文件并把结果写到一个文本文件中: <code>tesseract test.jpg text</code></li>
<li><code>cat text.txt</code> 即可显示结果。</li>
<li>识别结果很准确,不过符号<code>^</code>和<code>*</code>分别被表示成了双引号和单引号。大体上可以让你很舒服地阅读。</li>
</ul>
</li>
</ul>
<h3 id="7-3-通过Python代码实现"><a href="#7-3-通过Python代码实现" class="headerlink" title="7.3-通过Python代码实现"></a>7.3-通过Python代码实现</h3><ul>
<li><p>通过Python代码实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import pytesseract</span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">image = Image.open(&apos;test.jpg&apos;)</span><br><span class="line">text = pytesseract.image_to_string(image)</span><br><span class="line">print text</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This is some text, written in Arial, that will be read by</span><br><span class="line">Tesseract. Here are some symbols: !@#$%&quot;&amp;*()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="7-4-对图片进行阈值过滤和降噪处理（了解即可）"><a href="#7-4-对图片进行阈值过滤和降噪处理（了解即可）" class="headerlink" title="7.4-对图片进行阈值过滤和降噪处理（了解即可）"></a>7.4-对图片进行阈值过滤和降噪处理（了解即可）</h3><ul>
<li><p>很多时候我们在网上会看到这样的图片：</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-4/39994570.jpg?ynotemdtimestamp=1550480900687" alt="img"></p>
</li>
<li><p>Tesseract 不能完整处理这个图片,主要是因为图片背景色是渐变的,最终结果是这样:</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-4/36341178.jpg?ynotemdtimestamp=1550480900687" alt="img"></p>
</li>
<li><p>随着背景色从左到右不断加深,文字变得越来越难以识别,Tesseract 识别出的 每一行的最后几个字符都是错的。</p>
</li>
<li><p>遇到这类问题,可以先用 Python 脚本对图片进行清理。利用 Pillow 库,我们可以创建一个 阈值过滤器来去掉渐变的背景色,只把文字留下来,从而让图片更加清晰,便于 Tesseract 读取:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image </span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">def cleanFile(filePath, newFilePath): </span><br><span class="line">    image = Image.open(filePath)</span><br><span class="line"></span><br><span class="line">    # 对图片进行阈值过滤,然后保存</span><br><span class="line">    image = image.point(lambda x: 0 if x&lt;143 else 255)     </span><br><span class="line">    image.save(newFilePath)</span><br><span class="line"></span><br><span class="line">    # 调用系统的tesseract命令对图片进行OCR识别     </span><br><span class="line">    subprocess.call([&quot;tesseract&quot;, newFilePath, &quot;output&quot;])</span><br><span class="line"></span><br><span class="line">    # 打开文件读取结果</span><br><span class="line">    file = open(&quot;output.txt&quot;, &apos;r&apos;)     </span><br><span class="line">    print(file.read()) </span><br><span class="line">    file.close()</span><br><span class="line"></span><br><span class="line">cleanFile(&quot;text2.jpg&quot;, &quot;text2clean.png&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过一个阈值对前面的“模糊”图片进行过滤的结果</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-4/14228744.jpg?ynotemdtimestamp=1550480900687" alt="img"></p>
</li>
<li><p>除了一些标点符号不太清晰或丢失了,大部分文字都被读出来了。Tesseract 给出了最好的 结果:</p>
<p><img src="http://ot12pfxkm.bkt.clouddn.com/18-1-4/32143587.jpg?ynotemdtimestamp=1550480900687" alt="img"></p>
</li>
</ul>
<h3 id="7-5-从网站图片中抓取文字"><a href="#7-5-从网站图片中抓取文字" class="headerlink" title="7.5-从网站图片中抓取文字"></a>7.5-从网站图片中抓取文字</h3><ul>
<li><p>用 Tesseract 读取硬盘里图片上的文字,可能不怎么令人兴奋,但当我们把它和网络爬虫组合使用时,就能成为一个强大的工具。</p>
</li>
<li><p>网站上的图片可能并不是故意把文字做得很花哨 (就像餐馆菜单的 JPG 图片上的艺术字),但它们上面的文字对网络爬虫来说就是隐藏起来 了，举个例子：</p>
<ul>
<li>虽然亚马逊的 robots.txt 文件允许抓取网站的产品页面,但是图书的预览页通常不让网络机 器人采集。</li>
<li>图书的预览页是通过用户触发 Ajax 脚本进行加载的,预览图片隐藏在 div 节点 下面;其实,普通的访问者会觉得它们看起来更像是一个 Flash 动画,而不是一个图片文 件。当然,即使我们能获得图片,要把它们读成文字也没那么简单。</li>
<li>下面的程序就解决了这个问题:首先导航到托尔斯泰的《战争与和平》的大字号印刷版 1, 打开阅读器,收集图片的 URL 链接,然后下载图片,识别图片,最后打印每个图片的文 字。因为这个程序很复杂,利用了前面几章的多个程序片段,所以我增加了一些注释以让 每段代码的目的更加清晰:</li>
</ul>
</li>
<li><p>code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from urllib.request import urlretrieve </span><br><span class="line">import subprocess</span><br><span class="line">from selenium import webdriver</span><br><span class="line">#创建新的Selenium driver</span><br><span class="line">driver = webdriver.PhantomJS()</span><br><span class="line"></span><br><span class="line"># 用Selenium试试Firefox浏览器:</span><br><span class="line"># driver = webdriver.Firefox()</span><br><span class="line"></span><br><span class="line">driver.get(&quot;http://www.amazon.com/War-Peace-Leo-Nikolayevich-Tolstoy/dp/1427030200&quot;)</span><br><span class="line"># 单击图书预览按钮 driver.find_element_by_id(&quot;sitbLogoImg&quot;).click() imageList = set()</span><br><span class="line"># 等待页面加载完成</span><br><span class="line">time.sleep(5)</span><br><span class="line"># 当向右箭头可以点击时,开始翻页</span><br><span class="line">while &quot;pointer&quot; in driver.find_element_by_id(&quot;sitbReaderRightPageTurner&quot;).get_attribute(&quot;style&quot;):</span><br><span class="line">    driver.find_element_by_id(&quot;sitbReaderRightPageTurner&quot;).click()</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    # 获取已加载的新页面(一次可以加载多个页面,但是重复的页面不能加载到集合中) </span><br><span class="line">    pages = driver.find_elements_by_xpath(&quot;//div[@class=&apos;pageImage&apos;]/div/img&quot;) </span><br><span class="line">    for page in pages:</span><br><span class="line">        image = page.get_attribute(&quot;src&quot;)</span><br><span class="line">        imageList.add(image)</span><br><span class="line">driver.quit()</span><br><span class="line"></span><br><span class="line"># 用Tesseract处理我们收集的图片URL链接 </span><br><span class="line">for image in sorted(imageList):</span><br><span class="line">    # 保存图片</span><br><span class="line">    urlretrieve(image, &quot;page.jpg&quot;)</span><br><span class="line">    p = subprocess.Popen([&quot;tesseract&quot;, &quot;page.jpg&quot;, &quot;page&quot;], stdout=subprocess.PIPE,stderr=subprocess.PIPE)</span><br><span class="line">    f = open(&quot;page.txt&quot;, &quot;r&quot;)</span><br><span class="line">    p.wait() print(f.read())</span><br></pre></td></tr></table></figure>
</li>
<li><p>和我们前面使用 Tesseract 读取的效果一样,这个程序也会完美地打印书中很多长长的段 落,第六页的预览如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">     &quot;A word of friendly advice, mon</span><br><span class="line">     cher. Be off as soon as you can,</span><br><span class="line">     that&apos;s all I have to tell you. Happy</span><br><span class="line">     he who has ears to hear. Good-by,</span><br><span class="line">     my dear fellow. Oh, by the by!&quot; he</span><br><span class="line">     shouted through the doorway after</span><br><span class="line">     Pierre, &quot;is it true that the countess</span><br><span class="line">     has fallen into the clutches of the</span><br><span class="line">     holy fathers of the Society of je-</span><br><span class="line">     sus?&quot;</span><br><span class="line"></span><br><span class="line">     Pierre did not answer and left Ros-</span><br><span class="line">     topchin&apos;s room more sullen and an-</span><br><span class="line">     gry than he had ever before shown</span><br><span class="line">     himself.</span><br></pre></td></tr></table></figure>
</li>
<li><p>但是,当文字出现在彩色封面上时,结果就不那么完美了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WEI&apos; nrrd Peace</span><br><span class="line">Len Nlkelayevldu Iolfluy</span><br><span class="line">Readmg shmdd be ax</span><br><span class="line">wlnvame asnossxble Wenfler</span><br><span class="line">an mm m our cram: Llhvary</span><br><span class="line"> - Leo Tmsloy was a Russian rwovelwst</span><br><span class="line"> I and moval phflmopher med lur</span><br><span class="line"> A ms Ideas 01 nonviolenx reswslance m 5 We range     0, &quot;and&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果想把文字加工成普通人可以看懂的 效果,还需要花很多时间去处理。</p>
</li>
<li><p>下一节将介绍另一种方法来解决文字混乱的问题,尤其是当你愿意花一点儿时间训练 Tesseract 的时候。</p>
</li>
<li><p>通过给 Tesseract 提供大量已知的文字与图片映射集,经过训练 Tesseract 就可以“学会”识别同一种字体,而且可以达到极高的精确率和准确率,甚至可以忽略图 片中文字的背景色和相对位置等问题。</p>
</li>
</ul>
<h2 id="08-案例：对验证码进行机器识别处理"><a href="#08-案例：对验证码进行机器识别处理" class="headerlink" title="08-案例：对验证码进行机器识别处理"></a>08-案例：对验证码进行机器识别处理</h2><blockquote>
<p>尝试对知乎网验证码进行处理：</p>
</blockquote>
<ul>
<li><p>许多流行的内容管理系统即使加了验证码模块，其众所周知的注册页面也经常会遭到网络 机器人的垃圾注册。</p>
</li>
<li><p>那么，这些网络机器人究，竟是怎么做的呢?既然我们已经，可以成功地识别出保存在电脑上 的验证码了，那么如何才能实现一个全能的网络机器人呢?</p>
</li>
<li><p>大多数网站生成的验证码图片都具有以下属性。</p>
<ul>
<li>它们是服务器端的程序动态生成的图片。验证码图片的 src 属性可能和普通图片不太一 样，比如 <code>&lt;img src=&quot;WebForm.aspx?id=8AP85CQKE9TJ&quot;&gt;</code>，但是可以和其他图片一样进行 下载和处理。</li>
<li>图片的答案存储在服务器端的数据库里。</li>
<li>很多验证码都有时间限制，如果你太长时间没解决就会失效。</li>
<li>常用的处理方法就是，首先把验证码图片下载到硬盘里，清理干净，然后用 Tesseract 处理 图片，最后返回符合网站要求的识别结果。</li>
</ul>
</li>
<li><p>code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import pytesseract</span><br><span class="line">from PIL import Image</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line"></span><br><span class="line">def captcha(data):</span><br><span class="line">    with open(&apos;captcha.jpg&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">        fp.write(data)</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    image = Image.open(&quot;captcha.jpg&quot;)</span><br><span class="line">    text = pytesseract.image_to_string(image)</span><br><span class="line">    print &quot;机器识别后的验证码为：&quot; + text</span><br><span class="line">    command = raw_input(&quot;请输入Y表示同意使用，按其他键自行重新输入：&quot;)</span><br><span class="line">    if (command == &quot;Y&quot; or command == &quot;y&quot;):</span><br><span class="line">        return text</span><br><span class="line">    else:</span><br><span class="line">        return raw_input(&apos;输入验证码：&apos;)</span><br><span class="line"></span><br><span class="line">def zhihuLogin(username,password):</span><br><span class="line"></span><br><span class="line">    # 构建一个保存Cookie值的session对象</span><br><span class="line">    sessiona = requests.Session()</span><br><span class="line">    headers = &#123;&apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0&apos;&#125;</span><br><span class="line"></span><br><span class="line">    # 先获取页面信息，找到需要POST的数据（并且已记录当前页面的Cookie）</span><br><span class="line">    html = sessiona.get(&apos;https://www.zhihu.com/#signin&apos;, headers=headers).content</span><br><span class="line"></span><br><span class="line">    # 找到 name 属性值为 _xsrf 的input标签，取出value里的值</span><br><span class="line">    _xsrf = BeautifulSoup(html ,&apos;lxml&apos;).find(&apos;input&apos;, attrs=&#123;&apos;name&apos;:&apos;_xsrf&apos;&#125;).get(&apos;value&apos;)</span><br><span class="line"></span><br><span class="line">    # 取出验证码，r后面的值是Unix时间戳,time.time()</span><br><span class="line">    captcha_url = &apos;https://www.zhihu.com/captcha.gif?r=%d&amp;type=login&apos; % (time.time() * 1000)</span><br><span class="line">    response = sessiona.get(captcha_url, headers = headers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        &quot;_xsrf&quot;:_xsrf,</span><br><span class="line">        &quot;email&quot;:username,</span><br><span class="line">        &quot;password&quot;:password,</span><br><span class="line">        &quot;remember_me&quot;:True,</span><br><span class="line">        &quot;captcha&quot;: captcha(response.content)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = sessiona.post(&apos;https://www.zhihu.com/login/email&apos;, data = data, headers=headers)</span><br><span class="line">    print response.text</span><br><span class="line"></span><br><span class="line">    response = sessiona.get(&apos;https://www.zhihu.com/people/maozhaojun/activities&apos;, headers=headers)</span><br><span class="line">    print response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    #username = raw_input(&quot;username&quot;)</span><br><span class="line">    #password = raw_input(&quot;password&quot;)</span><br><span class="line">    zhihuLogin(&apos;xxxx@qq.com&apos;,&apos;ALAxxxxIME&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>值得注意的是，有两种异常情况会导致这个程序运行失败。第一种情况是，如果 Tesseract 从验证码图片中识别的结果不是四个字符(因为训练样本中验证码的所有有效答案都必须 是四个字符)，结果不会被提交，程序失败。第二种情况是虽然识别的结果是四个字符， 被提交到了表单，但是服务器对结果不认可，程序仍然失败。</p>
</li>
<li><p>在实际运行过程中，第一种 情况发生的可能性大约为 50%，发生时程序不会向表单提交，程序直接结束并提示验证码 识别错误。第二种异常情况发生的概率约为 20%，四个字符都对的概率约是 30%(每个字 母的识别正确率大约是 80%，如果是五个字符都识别，正确的总概率是 32.8%)。</p>
</li>
</ul>
<h2 id="09-机器学习：训练Tesseract"><a href="#09-机器学习：训练Tesseract" class="headerlink" title="09-机器学习：训练Tesseract"></a>09-机器学习：训练Tesseract</h2><ul>
<li><p>大多数其他的验证码都是比较简单的。例如，流行的 PHP 内容管理系统 Drupal 有一个著 名的验证码模块(<a href="https://www.drupal.org/project/captcha" target="_blank" rel="noopener">https://www.drupal.org/project/captcha)，可以生成不同难度的验证码。</a>%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%9F%E6%88%90%E4%B8%8D%E5%90%8C%E9%9A%BE%E5%BA%A6%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%E3%80%82)</p>
</li>
<li><p>那么与其他验证码相比，究竟是什么让这个验证码更容易被人类和机器读懂呢?</p>
<ul>
<li>字母没有相互叠加在一起，在水平方向上也没有彼此交叉。也就是说，可以在每一个字 母外面画一个方框，而不会重叠在一起。</li>
<li>图片没有背景色、线条或其他对 OCR 程序产生干扰的噪点。</li>
<li>虽然不能因一个图片下定论，但是这个验证码用的字体种类很少，而且用的是 sans-serif 字体(像“4”和“M”)和一种手写形式的字体(像“m”“C”和“3”)。</li>
<li>白色背景色与深色字母之间的对比度很高。</li>
</ul>
</li>
<li><p>这个验证码只做了一点点改变，就让 OCR 程序很难识别。</p>
<ul>
<li>字母和数据都使用了，这会增加待搜索字符的数量。</li>
<li>字母随机的倾斜程度会迷惑 OCR 软件，但是人类还是很容易识别的。</li>
<li>那个比较陌生的手写字体很有挑战性，在“C”和“3”里面还有额外的线条。另外这 个非常小的小写“m”，计算机需要进行额外的训练才能识别。 用下面的代码运行 Tesseract 识别图片:</li>
</ul>
</li>
<li><p><code>tesseract captchaExample.png output</code></p>
<p>我们得到的结果 output.txt 是: 4N\，，，C&lt;3</p>
</li>
<li><p>要训练 Tesseract 识别一种文字，无论是晦涩难懂的字体还是验证码，你都需要向 Tesseract 提供每个字符不同形式的样本。</p>
</li>
<li><p>做这个枯燥的工作可能要花好几个小时的时间，你可能更想用这点儿时间找个好看的视频 或电影看看。首先要把大量的验证码样本下载到一个文件夹里。</p>
</li>
<li><p>下载的样本数量由验证码 的复杂程度决定;我在训练集里一共放了 100 个样本(一共 500 个字符，平均每个字符 8 个样本;a~z 大小写字母加 0~9 数字，一共 62 个字符)，应该足够训练的了。</p>
</li>
<li><p>提示:建议使用验证码的真实结果给每个样本文件命名(即4MmC3.jpg)。 这样可以帮你 一次性对大量的文件进行快速检查——你可以先把图片调成缩略图模式，然后通过文件名 对比不同的图片。这样在后面的步骤中进行训练效果的检查也会很方便。</p>
</li>
<li><p>第二步是准确地告诉 Tesseract 一张图片中的每个字符是什么，以及每个字符的具体位置。 这里需要创建一些矩形定位文件(box file)，一个验证码图片生成一个矩形定位文件。一 个图片的矩形定位文件如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 15 26 33 55 0</span><br><span class="line">M 38 13 67 45 0</span><br><span class="line">m 79 15 101 26 0</span><br><span class="line">C 111 33 136 60 0</span><br><span class="line">3 147 17 176 45 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>第一列符号是图片中的每个字符，后面的 4 个数字分别是包围这个字符的最小矩形的坐标 (图片左下角是原点 (0，0)，4 个数字分别对应每个字符的左下角 x 坐标、左下角 y 坐标、右上角 x 坐标和右上角 y 坐标)，最后一个数字“0”表示图片样本的编号。</p>
</li>
<li><p>显然，手工创建这些图片矩形定位文件很无聊，不过有一些工具可以帮你完成。我很喜欢 在线工具 Tesseract OCR Chopper(<a href="http://pp19dd.com/tesseract-ocr-chopper/" target="_blank" rel="noopener">http://pp19dd.com/tesseract-ocr-chopper/)，因为它不需要</a>%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%AE%83%E4%B8%8D%E9%9C%80%E8%A6%81) 安装，也没有其他依赖，只要有浏览器就可以运行，而且用法很简单:上传图片，如果要 增加新矩形就单击“add”按钮，还可以根据需要调整矩形的尺寸，最后把新生成的矩形 定位文件复制到一个新文件里就可以了。</p>
</li>
<li><p>矩形定位文件必须保存在一个 .box 后缀的文本文件中。和图片文件一样，文本文件也是用 验证码的实际结果命名(例如，4MmC3.box)。另外，这样便于检查 .box 文件的内容和文件的名称，而且按文件名对目录中的文件排序之后，就可以让 .box 文件与对应的图片文件 的实际结果进行对比。</p>
</li>
<li><p>你还需要创建大约 100 个 .box 文件来保证你有足够的训练数据。因为 Tesseract 会忽略那 些不能读取的文件，所以建议你尽量多做一些矩形定位文件，以保证训练足够充分。如果 你觉得训练的 OCR 结果没有达到你的目标，或者 Tesseract 识别某些字符时总是出错，多 创建一些训练数据然后重新训练将是一个不错的改进方法。</p>
</li>
<li><p>创建完满载 .box 文件和图片文件的数据文件夹之后，在做进一步分析之前最好备份一下这 个文件夹。虽然在数据上运行训练程序不太可能删除任何数据，但是创建 .box 文件用了你 好几个小时的时间，来之不易，稳妥一点儿总没错。此外，能够抓取一个满是编译数据的 混乱目录，然后再尝试一次，总是好的。</p>
</li>
<li><p>前面的内容只是对 Tesseract 库强大的字体训练和识别能力的一个简略概述。如果你对 Tesseract 的其他训练方法感兴趣，甚至打算建立自己的验证码训练文件库，或者想和全世 界的 Tesseract 爱好者分享自己对一种新字体的识别成果，推荐阅读 Tesseract 的文档：<a href="https://github.com/tesseract-ocr/tesseract/wiki" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract/wiki</a>，加油！</p>
</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"># python</a>
          
            <a href="/tags/爬虫/" rel="tag"># 爬虫</a>
          
            <a href="/tags/图像识别/" rel="tag"># 图像识别</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/04/Scrapy实战项目/" rel="next" title="Scrapy实战项目">
                <i class="fa fa-chevron-left"></i> Scrapy实战项目
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/04/非结构化数据-结构化数据提取-1/" rel="prev" title="非结构化数据&结构化数据提取-1">
                非结构化数据&结构化数据提取-1 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ry1ynn">
            
              <p class="site-author-name" itemprop="name">Ry1ynn</p>
              <p class="site-description motion-element" itemprop="description">我们的征途是星辰大海</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">108</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">45</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ry1ynn" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ry1ynn_pri@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/5794121667" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="/images/weixin.JPG" target="_blank" title="Wechat">
                      
                        <i class="fa fa-fw fa-weixin"></i>Wechat</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.t00ls.net/" title="T00ls" target="_blank">T00ls</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.freebuf.com/" title="FreeBuf" target="_blank">FreeBuf</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.sec-wiki.com/" title="SecWiki" target="_blank">SecWiki</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.seebug.org/" title="Seebug" target="_blank">Seebug</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.91ri.org/" title="91Ri" target="_blank">91Ri</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.pediy.com/" title="看雪" target="_blank">看雪</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.52pojie.cn/" title="吾爱破解" target="_blank">吾爱破解</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.anquanke.com/" title="安全客" target="_blank">安全客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.ichunqiu.com/" title="i春秋" target="_blank">i春秋</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#动态HTML处理-amp-机器图像识别"><span class="nav-text">动态HTML处理&amp;机器图像识别</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#03-案例1：网站模拟登录"><span class="nav-text">03-案例1：网站模拟登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#04-案例2：动态页面模拟点击"><span class="nav-text">04-案例2：动态页面模拟点击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#05-案例3：执行JavaScript语句"><span class="nav-text">05-案例3：执行JavaScript语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#06-机器视觉与Tesseract介绍"><span class="nav-text">06-机器视觉与Tesseract介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-机器视觉"><span class="nav-text">6.1-机器视觉</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-ORC库概述"><span class="nav-text">6.2-ORC库概述</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#07-处理一些格式规范的文字"><span class="nav-text">07-处理一些格式规范的文字</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-处理给规范的文字"><span class="nav-text">7.1-处理给规范的文字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-格式规范文字的理想示例"><span class="nav-text">7.2-格式规范文字的理想示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-通过Python代码实现"><span class="nav-text">7.3-通过Python代码实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-对图片进行阈值过滤和降噪处理（了解即可）"><span class="nav-text">7.4-对图片进行阈值过滤和降噪处理（了解即可）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-从网站图片中抓取文字"><span class="nav-text">7.5-从网站图片中抓取文字</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#08-案例：对验证码进行机器识别处理"><span class="nav-text">08-案例：对验证码进行机器识别处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#09-机器学习：训练Tesseract"><span class="nav-text">09-机器学习：训练Tesseract</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ry1ynn</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  










  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script id="ribbon" type="text/javascript" size="300" alpha="0.5" zindex="0" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
